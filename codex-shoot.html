<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="ai.author" content="ChatGPT-5.3-Codex">
  <meta name="ai.note" content="This file was generated by ChatGPT-5.3-Codex.">
  <title>Shooting Game - ChatGPT-5.3-Codex</title>
  <style>
    :root {
      --bg0: #05050d;
      --bg1: #090f24;
      --panel: rgba(10, 16, 36, 0.86);
      --text: #e7ecff;
      --muted: #98a6d4;
      --accent: #4fd1ff;
      --accent2: #ff7de2;
      --danger: #ff5f74;
      --ok: #4dffac;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--text);
      background:
        radial-gradient(circle at 20% 12%, rgba(79, 209, 255, 0.18), transparent 45%),
        radial-gradient(circle at 90% 8%, rgba(255, 125, 226, 0.2), transparent 45%),
        linear-gradient(140deg, var(--bg0), var(--bg1));
      font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      overflow: hidden;
    }
    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px;
      height: 100vh;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      gap: 10px;
    }
    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 12px;
      padding: 8px 12px;
    }
    .title {
      font-size: clamp(18px, 3vw, 28px);
      font-weight: 800;
      letter-spacing: 0.02em;
    }
    .controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .btn {
      border: 1px solid rgba(255,255,255,0.2);
      color: var(--text);
      background: rgba(255,255,255,0.08);
      border-radius: 999px;
      padding: 7px 12px;
      cursor: pointer;
      font-weight: 700;
    }
    .btn.primary {
      background: linear-gradient(120deg, var(--accent), var(--accent2));
      color: #081225;
      border-color: transparent;
    }
    .hud {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }
    .card {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 10px;
      padding: 8px 10px;
    }
    .label {
      font-size: 11px;
      color: var(--muted);
    }
    .value {
      font-size: 22px;
      font-weight: 800;
      line-height: 1.2;
    }
    .stage {
      position: relative;
      background: #03050b;
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 14px;
      overflow: hidden;
      min-height: 300px;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    .overlay {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(2, 4, 10, 0.72);
      backdrop-filter: blur(2px);
      text-align: center;
      padding: 14px;
    }
    .overlay.show { display: flex; }
    .box {
      max-width: 520px;
      background: rgba(10,16,36,0.95);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 12px;
      padding: 16px;
    }
    .box h2 {
      margin: 0 0 10px;
      font-size: 28px;
    }
    .box p {
      margin: 8px 0;
      color: var(--muted);
      line-height: 1.5;
    }
    .touch {
      display: none;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }
    .touch button {
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      padding: 10px 0;
      font-weight: 700;
      font-size: 16px;
    }
    @media (max-width: 760px) {
      .app { padding: 8px; gap: 8px; }
      .hud { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .touch { display: grid; }
      .value { font-size: 18px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top">
      <div class="title">Shooting Game // Codex 5.3</div>
      <div class="controls">
        <button class="btn" id="pauseBtn">Pause</button>
        <button class="btn" id="restartBtn">Restart</button>
      </div>
    </div>
    <div class="hud">
      <div class="card"><div class="label">SCORE</div><div class="value" id="score">0</div></div>
      <div class="card"><div class="label">LIVES</div><div class="value" id="lives">3</div></div>
      <div class="card"><div class="label">BOMB</div><div class="value" id="bombs">2</div></div>
      <div class="card"><div class="label">MULTI</div><div class="value" id="multi">x1</div></div>
    </div>
    <div class="stage" id="stage">
      <canvas id="game" width="1280" height="720"></canvas>
      <div class="overlay show" id="start">
        <div class="box">
          <h2>Launch</h2>
          <p>Move: Arrow / WASD, Shoot: Space or J, Bomb: K, Pause: P</p>
          <p>Bomb clears bullets and enemies. Collect cyan chips to increase firepower.</p>
          <button class="btn primary" id="startBtn">Start</button>
        </div>
      </div>
      <div class="overlay" id="over">
        <div class="box">
          <h2>Game Over</h2>
          <p id="final"></p>
          <button class="btn primary" id="retryBtn">Retry</button>
        </div>
      </div>
    </div>
    <div class="touch" id="touch">
      <button data-k="left">◀</button>
      <button data-k="right">▶</button>
      <button data-k="shoot">●</button>
      <button data-k="bomb">◆</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const stage = document.getElementById("stage");
    const scoreEl = document.getElementById("score");
    const livesEl = document.getElementById("lives");
    const bombsEl = document.getElementById("bombs");
    const multiEl = document.getElementById("multi");
    const startOverlay = document.getElementById("start");
    const overOverlay = document.getElementById("over");
    const finalEl = document.getElementById("final");
    const pauseBtn = document.getElementById("pauseBtn");

    const W = 1280;
    const H = 720;
    const GROUND = H - 50;

    const state = {
      started: false,
      paused: false,
      over: false,
      score: 0,
      lives: 3,
      bombs: 2,
      multi: 1,
      t: 0,
      spawn: 0,
      fireCd: 0,
      hitFlash: 0,
    };

    const key = { up: false, down: false, left: false, right: false, shoot: false };
    const stars = Array.from({ length: 140 }, () => ({
      x: Math.random() * W,
      y: Math.random() * (GROUND - 20),
      r: Math.random() * 1.8 + 0.2,
      s: Math.random() * 1.2 + 0.3
    }));

    const player = { x: 120, y: H * 0.45, w: 48, h: 26, speed: 420, inv: 0, power: 1 };
    const bullets = [];
    const enemies = [];
    const enemyBullets = [];
    const chips = [];
    const particles = [];

    function resetGame() {
      state.started = false;
      state.paused = false;
      state.over = false;
      state.score = 0;
      state.lives = 3;
      state.bombs = 2;
      state.multi = 1;
      state.t = 0;
      state.spawn = 0;
      state.fireCd = 0;
      state.hitFlash = 0;
      player.x = 120;
      player.y = H * 0.45;
      player.inv = 0;
      player.power = 1;
      bullets.length = 0;
      enemies.length = 0;
      enemyBullets.length = 0;
      chips.length = 0;
      particles.length = 0;
      startOverlay.classList.add("show");
      overOverlay.classList.remove("show");
      updateHUD();
    }

    function updateHUD() {
      scoreEl.textContent = Math.floor(state.score);
      livesEl.textContent = state.lives;
      bombsEl.textContent = state.bombs;
      multiEl.textContent = `x${state.multi}`;
    }

    function resize() {
      const r = stage.getBoundingClientRect();
      const sw = Math.max(360, r.width);
      const sh = Math.max(240, r.height);
      let dw = sw;
      let dh = (dw * H) / W;
      if (dh > sh) {
        dh = sh;
        dw = (dh * W) / H;
      }
      canvas.style.width = `${Math.floor(dw)}px`;
      canvas.style.height = `${Math.floor(dh)}px`;
    }

    function spawnEnemy() {
      const type = Math.floor(Math.random() * 3);
      const enemy = {
        x: W + 50,
        y: 40 + Math.random() * (GROUND - 120),
        w: 36,
        h: 30,
        hp: type + 1,
        t: 0,
        type,
        speed: [180, 150, 220][type],
        fire: 0.6 + Math.random() * 1.2,
        color: ["#ff5f74", "#4d89ff", "#d869ff"][type],
        points: [90, 130, 180][type]
      };
      enemies.push(enemy);
    }

    function burst(x, y, color, count) {
      for (let i = 0; i < count; i++) {
        const a = Math.random() * Math.PI * 2;
        const s = Math.random() * 220 + 40;
        particles.push({
          x, y, vx: Math.cos(a) * s, vy: Math.sin(a) * s, life: 0.5 + Math.random() * 0.5, color
        });
      }
    }

    function firePlayer() {
      const by = player.y + player.h * 0.5;
      bullets.push({ x: player.x + player.w, y: by, vx: 780, d: 0 });
      if (player.power >= 2) {
        bullets.push({ x: player.x + player.w - 2, y: by - 10, vx: 760, d: -1 });
        bullets.push({ x: player.x + player.w - 2, y: by + 10, vx: 760, d: 1 });
      }
      if (player.power >= 3) {
        bullets.push({ x: player.x + player.w - 5, y: by, vx: 840, d: 0 });
      }
    }

    function bomb() {
      if (state.bombs <= 0) return;
      state.bombs -= 1;
      burst(player.x + player.w * 0.5, player.y + player.h * 0.5, "rgba(79,209,255,0.9)", 70);
      for (let i = enemies.length - 1; i >= 0; i--) {
        state.score += enemies[i].points * state.multi;
        if (Math.random() < 0.2) chips.push({ x: enemies[i].x, y: enemies[i].y, w: 14, h: 14 });
        enemies.splice(i, 1);
      }
      enemyBullets.length = 0;
      state.multi = Math.min(8, state.multi + 1);
      updateHUD();
    }

    function hitPlayer() {
      if (player.inv > 0) return;
      state.lives -= 1;
      player.inv = 1.2;
      state.hitFlash = 0.4;
      state.multi = 1;
      burst(player.x, player.y, "rgba(255,95,116,0.95)", 40);
      if (state.lives <= 0) {
        state.over = true;
        finalEl.textContent = `Score ${Math.floor(state.score)}`;
        overOverlay.classList.add("show");
      }
      updateHUD();
    }

    function intersects(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    function update(dt) {
      state.t += dt;
      state.spawn += dt;
      state.fireCd = Math.max(0, state.fireCd - dt);
      player.inv = Math.max(0, player.inv - dt);
      state.hitFlash = Math.max(0, state.hitFlash - dt);

      const mv = player.speed * dt;
      if (key.up) player.y -= mv;
      if (key.down) player.y += mv;
      if (key.left) player.x -= mv;
      if (key.right) player.x += mv;

      player.x = Math.max(12, Math.min(W - player.w - 12, player.x));
      player.y = Math.max(12, Math.min(GROUND - player.h - 6, player.y));

      if (key.shoot && state.fireCd === 0) {
        firePlayer();
        state.fireCd = Math.max(0.06, 0.14 - player.power * 0.02);
      }

      if (state.spawn > Math.max(0.35, 1.2 - state.t * 0.02)) {
        state.spawn = 0;
        spawnEnemy();
      }

      for (const b of bullets) {
        b.x += b.vx * dt;
        b.y += b.d * 160 * dt;
      }
      for (let i = bullets.length - 1; i >= 0; i--) {
        if (bullets[i].x > W + 30 || bullets[i].y < -10 || bullets[i].y > GROUND + 10) bullets.splice(i, 1);
      }

      for (const e of enemies) {
        e.t += dt;
        e.x -= e.speed * dt;
        if (e.type === 0) e.y += Math.sin(e.t * 7) * 1.8;
        if (e.type === 1) e.y += Math.cos(e.t * 4.5) * 1.2;
        if (e.type === 2) e.y += Math.sin(e.t * 9) * 2.2;
        e.fire -= dt;
        if (e.fire <= 0) {
          e.fire = 1 + Math.random() * 1.4;
          enemyBullets.push({
            x: e.x, y: e.y + e.h * 0.5, vx: -280 - Math.random() * 90, vy: (player.y - e.y) * 0.6
          });
        }
      }
      for (let i = enemies.length - 1; i >= 0; i--) {
        if (enemies[i].x + enemies[i].w < -50) enemies.splice(i, 1);
      }

      for (const eb of enemyBullets) {
        eb.x += eb.vx * dt;
        eb.y += eb.vy * dt;
      }
      for (let i = enemyBullets.length - 1; i >= 0; i--) {
        const eb = enemyBullets[i];
        if (eb.x < -40 || eb.y < -40 || eb.y > H + 40) enemyBullets.splice(i, 1);
      }

      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        const box = { x: b.x - 2, y: b.y - 2, w: 4, h: 4 };
        for (let j = enemies.length - 1; j >= 0; j--) {
          const e = enemies[j];
          if (!intersects(box, e)) continue;
          e.hp -= 1;
          bullets.splice(i, 1);
          if (e.hp <= 0) {
            state.score += e.points * state.multi;
            if (Math.random() < 0.16) chips.push({ x: e.x, y: e.y, w: 14, h: 14 });
            burst(e.x + e.w * 0.5, e.y + e.h * 0.5, e.color, 18);
            enemies.splice(j, 1);
            state.multi = Math.min(8, state.multi + 1);
            updateHUD();
          }
          break;
        }
      }

      for (let i = enemyBullets.length - 1; i >= 0; i--) {
        const eb = enemyBullets[i];
        const box = { x: eb.x - 3, y: eb.y - 3, w: 6, h: 6 };
        if (intersects(player, box)) {
          enemyBullets.splice(i, 1);
          hitPlayer();
          break;
        }
      }
      for (let i = enemies.length - 1; i >= 0; i--) {
        if (intersects(player, enemies[i])) {
          enemies.splice(i, 1);
          hitPlayer();
          break;
        }
      }

      for (const c of chips) c.x -= 190 * dt;
      for (let i = chips.length - 1; i >= 0; i--) {
        if (chips[i].x < -20) {
          chips.splice(i, 1);
          continue;
        }
        if (intersects(player, chips[i])) {
          chips.splice(i, 1);
          player.power = Math.min(3, player.power + 1);
          state.score += 70;
          updateHUD();
        }
      }

      for (const p of particles) {
        p.life -= dt;
        p.x += p.vx * dt;
        p.y += p.vy * dt;
        p.vx *= 0.96;
        p.vy *= 0.96;
      }
      for (let i = particles.length - 1; i >= 0; i--) if (particles[i].life <= 0) particles.splice(i, 1);

      state.score += dt * (8 + state.multi);
      updateHUD();
    }

    function draw() {
      ctx.clearRect(0, 0, W, H);

      const sky = ctx.createLinearGradient(0, 0, 0, H);
      sky.addColorStop(0, "#0b1530");
      sky.addColorStop(0.65, "#08101f");
      sky.addColorStop(1, "#1e130f");
      ctx.fillStyle = sky;
      ctx.fillRect(0, 0, W, H);

      for (const s of stars) {
        s.x -= s.s;
        if (s.x < -2) { s.x = W + 2; s.y = Math.random() * (GROUND - 20); }
        ctx.fillStyle = "rgba(255,255,255,0.85)";
        ctx.fillRect(s.x, s.y, s.r, s.r);
      }

      ctx.fillStyle = "#2a1b19";
      ctx.fillRect(0, GROUND, W, H - GROUND);

      ctx.fillStyle = "#3a2f3f";
      for (let i = 0; i < 14; i++) {
        const x = (i * 120 - (state.t * 140) % 120);
        ctx.fillRect(x, GROUND - 28, 52, 28);
      }

      for (const c of chips) {
        ctx.fillStyle = "#4fd1ff";
        ctx.fillRect(c.x, c.y, c.w, c.h);
        ctx.fillStyle = "rgba(255,255,255,0.9)";
        ctx.fillRect(c.x + 4, c.y + 4, 6, 6);
      }

      for (const b of bullets) {
        ctx.fillStyle = "#fff16a";
        ctx.fillRect(b.x - 6, b.y - 1.5, 12, 3);
      }
      for (const eb of enemyBullets) {
        ctx.fillStyle = "#ff7292";
        ctx.fillRect(eb.x - 3, eb.y - 3, 6, 6);
      }

      for (const e of enemies) {
        ctx.fillStyle = e.color;
        ctx.fillRect(e.x, e.y, e.w, e.h);
        ctx.fillStyle = "rgba(0,0,0,0.45)";
        ctx.fillRect(e.x + 5, e.y + 6, 6, 6);
        ctx.fillRect(e.x + e.w - 11, e.y + 6, 6, 6);
      }

      for (const p of particles) {
        ctx.globalAlpha = Math.max(0, p.life);
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x - 2, p.y - 2, 4, 4);
      }
      ctx.globalAlpha = 1;

      if (!(player.inv > 0 && Math.floor(player.inv * 20) % 2 === 0)) {
        ctx.fillStyle = "#53ffa6";
        ctx.beginPath();
        ctx.moveTo(player.x + player.w, player.y + player.h * 0.5);
        ctx.lineTo(player.x + 2, player.y);
        ctx.lineTo(player.x + 10, player.y + player.h * 0.5);
        ctx.lineTo(player.x + 2, player.y + player.h);
        ctx.closePath();
        ctx.fill();
        ctx.fillStyle = state.multi >= 5 ? "#ffe45f" : "#ff9edc";
        ctx.fillRect(player.x - 8, player.y + player.h * 0.5 - 3, 8, 6);
      }

      if (state.hitFlash > 0) {
        ctx.fillStyle = `rgba(255,80,100,${state.hitFlash * 0.35})`;
        ctx.fillRect(0, 0, W, H);
      }
    }

    let last = 0;
    function loop(ts) {
      if (!last) last = ts;
      const dt = Math.min(0.033, (ts - last) / 1000);
      last = ts;

      if (state.started && !state.paused && !state.over) update(dt);
      draw();
      requestAnimationFrame(loop);
    }

    function startGame() {
      state.started = true;
      state.paused = false;
      state.over = false;
      startOverlay.classList.remove("show");
      overOverlay.classList.remove("show");
      pauseBtn.textContent = "Pause";
    }

    function setKey(code, v) {
      if (code === "ArrowUp" || code === "KeyW") key.up = v;
      if (code === "ArrowDown" || code === "KeyS") key.down = v;
      if (code === "ArrowLeft" || code === "KeyA") key.left = v;
      if (code === "ArrowRight" || code === "KeyD") key.right = v;
      if (code === "Space" || code === "KeyJ") key.shoot = v;
    }

    document.addEventListener("keydown", (e) => {
      if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(e.code)) e.preventDefault();
      if (!state.started && !state.over) startGame();
      setKey(e.code, true);
      if (e.code === "KeyK") bomb();
      if (e.code === "KeyP") {
        if (!state.started || state.over) return;
        state.paused = !state.paused;
        pauseBtn.textContent = state.paused ? "Resume" : "Pause";
      }
      if (e.code === "KeyR") {
        resetGame();
        startGame();
      }
    }, { passive: false });
    document.addEventListener("keyup", (e) => setKey(e.code, false));

    document.getElementById("startBtn").addEventListener("click", () => startGame());
    document.getElementById("retryBtn").addEventListener("click", () => {
      resetGame();
      startGame();
    });
    document.getElementById("restartBtn").addEventListener("click", () => {
      resetGame();
      startGame();
    });
    pauseBtn.addEventListener("click", () => {
      if (!state.started || state.over) return;
      state.paused = !state.paused;
      pauseBtn.textContent = state.paused ? "Resume" : "Pause";
    });

    document.querySelectorAll("#touch button").forEach((btn) => {
      const k = btn.dataset.k;
      btn.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        if (!state.started) startGame();
        if (k === "left") key.left = true;
        if (k === "right") key.right = true;
        if (k === "shoot") key.shoot = true;
        if (k === "bomb") bomb();
      });
      const up = () => {
        if (k === "left") key.left = false;
        if (k === "right") key.right = false;
        if (k === "shoot") key.shoot = false;
      };
      btn.addEventListener("pointerup", up);
      btn.addEventListener("pointerleave", up);
      btn.addEventListener("pointercancel", up);
    });

    window.addEventListener("resize", resize);
    resize();
    resetGame();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
