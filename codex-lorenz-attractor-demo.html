<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="ai.author" content="ChatGPT-5.3-Codex">
  <meta name="ai.note" content="This file was generated by ChatGPT-5.3-Codex.">
  <title>Lorenz Attractor Demo - ChatGPT-5.3-Codex</title>
  <style>
    :root {
      --bg: #050812;
      --panel: rgba(10, 16, 31, 0.78);
      --line: rgba(143, 200, 255, 0.28);
      --text: #dce9ff;
      --muted: #99accf;
      --accent: #77d9ff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      overflow: hidden;
      background:
        radial-gradient(circle at 18% 12%, rgba(93, 189, 255, 0.2), transparent 35%),
        radial-gradient(circle at 82% 8%, rgba(255, 103, 154, 0.16), transparent 32%),
        linear-gradient(160deg, #04070f, var(--bg));
      color: var(--text);
      font-family: "Segoe UI", sans-serif;
    }
    canvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
    .hud {
      position: fixed;
      left: 12px;
      top: 12px;
      width: min(320px, calc(100vw - 24px));
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      backdrop-filter: blur(4px);
      padding: 10px 12px;
    }
    .hud h1 {
      margin: 0 0 8px;
      font-size: 15px;
      color: var(--accent);
      letter-spacing: 0.05em;
    }
    .row {
      display: grid;
      grid-template-columns: 46px 1fr 58px;
      gap: 8px;
      align-items: center;
      margin: 6px 0;
      font-size: 12px;
      color: var(--muted);
    }
    .row output {
      text-align: right;
      font-variant-numeric: tabular-nums;
      color: var(--text);
    }
    input[type="range"] {
      width: 100%;
      accent-color: #74d9ff;
    }
    .buttons {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    button {
      border: 1px solid #3b4f7a;
      background: #172544;
      color: #e8f1ff;
      border-radius: 8px;
      font-size: 12px;
      padding: 7px 11px;
      cursor: pointer;
    }
    button:hover { background: #1d2f57; }
    .note {
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <canvas id="cv"></canvas>
  <section class="hud">
    <h1>LORENZ ATTRACTOR // CODEX 5.3</h1>
    <div class="row">
      <label for="sigma">sigma</label>
      <input id="sigma" type="range" min="2" max="30" step="0.1" value="10">
      <output id="sigma-v">10.0</output>
    </div>
    <div class="row">
      <label for="rho">rho</label>
      <input id="rho" type="range" min="5" max="60" step="0.1" value="28">
      <output id="rho-v">28.0</output>
    </div>
    <div class="row">
      <label for="beta">beta</label>
      <input id="beta" type="range" min="0.5" max="6" step="0.01" value="2.67">
      <output id="beta-v">2.67</output>
    </div>
    <div class="row">
      <label for="speed">speed</label>
      <input id="speed" type="range" min="1" max="18" step="1" value="8">
      <output id="speed-v">8</output>
    </div>
    <div class="buttons">
      <button id="btn-reset">Reset</button>
      <button id="btn-freeze">Pause</button>
      <button id="btn-clear">Clear Trail</button>
    </div>
    <div class="note">
      Drag to rotate / wheel to zoom.<br>
      軌道色は時間で変化します。
    </div>
  </section>

  <script>
    const canvas = document.getElementById("cv");
    const ctx = canvas.getContext("2d");

    const ui = {
      sigma: document.getElementById("sigma"),
      rho: document.getElementById("rho"),
      beta: document.getElementById("beta"),
      speed: document.getElementById("speed"),
      sigmaV: document.getElementById("sigma-v"),
      rhoV: document.getElementById("rho-v"),
      betaV: document.getElementById("beta-v"),
      speedV: document.getElementById("speed-v"),
      reset: document.getElementById("btn-reset"),
      freeze: document.getElementById("btn-freeze"),
      clear: document.getElementById("btn-clear")
    };

    const state = {
      sigma: 10,
      rho: 28,
      beta: 2.67,
      dt: 0.008,
      zoom: 10.5,
      yaw: 0.64,
      pitch: 0.33,
      paused: false,
      x: 0.1,
      y: 0,
      z: 0,
      points: [],
      maxPoints: 9500,
      drag: false,
      lastMX: 0,
      lastMY: 0
    };

    function resize() {
      canvas.width = Math.floor(window.innerWidth * window.devicePixelRatio);
      canvas.height = Math.floor(window.innerHeight * window.devicePixelRatio);
      ctx.setTransform(window.devicePixelRatio, 0, 0, window.devicePixelRatio, 0, 0);
    }

    function updateLabels() {
      ui.sigmaV.textContent = Number(state.sigma).toFixed(1);
      ui.rhoV.textContent = Number(state.rho).toFixed(1);
      ui.betaV.textContent = Number(state.beta).toFixed(2);
      ui.speedV.textContent = String(Math.round(1 / state.dt * 0.064));
    }

    function setFromUI() {
      state.sigma = parseFloat(ui.sigma.value);
      state.rho = parseFloat(ui.rho.value);
      state.beta = parseFloat(ui.beta.value);
      const speed = parseFloat(ui.speed.value);
      state.dt = 0.0015 + speed * 0.0008;
      updateLabels();
    }

    function restart() {
      state.x = 0.1;
      state.y = 0.0;
      state.z = 0.0;
      state.points = [];
    }

    function integrate(stepCount) {
      for (let i = 0; i < stepCount; i++) {
        const dx = state.sigma * (state.y - state.x);
        const dy = state.x * (state.rho - state.z) - state.y;
        const dz = state.x * state.y - state.beta * state.z;
        state.x += dx * state.dt;
        state.y += dy * state.dt;
        state.z += dz * state.dt;
        state.points.push({ x: state.x, y: state.y, z: state.z });
      }
      if (state.points.length > state.maxPoints) {
        state.points.splice(0, state.points.length - state.maxPoints);
      }
    }

    function project(p) {
      const cy = Math.cos(state.yaw);
      const sy = Math.sin(state.yaw);
      const cp = Math.cos(state.pitch);
      const sp = Math.sin(state.pitch);

      const x1 = p.x * cy - p.z * sy;
      const z1 = p.x * sy + p.z * cy;
      const y2 = p.y * cp - z1 * sp;
      const z2 = p.y * sp + z1 * cp;

      const depth = 180 / (180 + z2 * 2.6);
      const sx = x1 * state.zoom * depth;
      const sy2 = y2 * state.zoom * depth;
      return { x: sx, y: sy2, d: depth };
    }

    function drawAxes() {
      const cX = window.innerWidth * 0.5;
      const cY = window.innerHeight * 0.52;

      const a = 3.3;
      const axes = [
        { p1: { x: -a, y: 0, z: 0 }, p2: { x: a, y: 0, z: 0 }, c: "rgba(255,120,120,0.3)" },
        { p1: { x: 0, y: -a, z: 0 }, p2: { x: 0, y: a, z: 0 }, c: "rgba(120,255,180,0.3)" },
        { p1: { x: 0, y: 0, z: -a }, p2: { x: 0, y: 0, z: a }, c: "rgba(140,170,255,0.3)" }
      ];

      ctx.lineWidth = 1;
      for (const a1 of axes) {
        const p1 = project(a1.p1);
        const p2 = project(a1.p2);
        ctx.strokeStyle = a1.c;
        ctx.beginPath();
        ctx.moveTo(cX + p1.x, cY - p1.y);
        ctx.lineTo(cX + p2.x, cY - p2.y);
        ctx.stroke();
      }
    }

    function drawTrail() {
      const cX = window.innerWidth * 0.5;
      const cY = window.innerHeight * 0.52;
      const n = state.points.length;
      if (n < 2) return;

      ctx.lineWidth = 1.65;
      for (let i = 1; i < n; i++) {
        const p0 = project(state.points[i - 1]);
        const p1 = project(state.points[i]);
        const t = i / n;
        const hue = (205 + t * 160 + performance.now() * 0.01) % 360;
        const alpha = 0.08 + t * 0.92;
        ctx.strokeStyle = `hsla(${hue}, 92%, 66%, ${alpha})`;
        ctx.beginPath();
        ctx.moveTo(cX + p0.x, cY - p0.y);
        ctx.lineTo(cX + p1.x, cY - p1.y);
        ctx.stroke();
      }

      const last = project(state.points[n - 1]);
      ctx.fillStyle = "rgba(255,255,255,0.9)";
      ctx.beginPath();
      ctx.arc(cX + last.x, cY - last.y, 2.6, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawBg() {
      const w = window.innerWidth;
      const h = window.innerHeight;
      ctx.clearRect(0, 0, w, h);

      const g = ctx.createLinearGradient(0, 0, 0, h);
      g.addColorStop(0, "rgba(6,11,22,0.45)");
      g.addColorStop(1, "rgba(2,5,10,0.82)");
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, w, h);
    }

    function frame() {
      if (!state.paused) integrate(14);
      drawBg();
      drawAxes();
      drawTrail();
      requestAnimationFrame(frame);
    }

    ui.sigma.addEventListener("input", setFromUI);
    ui.rho.addEventListener("input", setFromUI);
    ui.beta.addEventListener("input", setFromUI);
    ui.speed.addEventListener("input", setFromUI);
    ui.reset.addEventListener("click", () => restart());
    ui.clear.addEventListener("click", () => {
      state.points = [];
    });
    ui.freeze.addEventListener("click", () => {
      state.paused = !state.paused;
      ui.freeze.textContent = state.paused ? "Resume" : "Pause";
    });

    canvas.addEventListener("mousedown", (e) => {
      state.drag = true;
      state.lastMX = e.clientX;
      state.lastMY = e.clientY;
    });
    window.addEventListener("mouseup", () => { state.drag = false; });
    window.addEventListener("mousemove", (e) => {
      if (!state.drag) return;
      const dx = e.clientX - state.lastMX;
      const dy = e.clientY - state.lastMY;
      state.lastMX = e.clientX;
      state.lastMY = e.clientY;
      state.yaw += dx * 0.006;
      state.pitch += dy * 0.004;
      state.pitch = Math.max(-1.4, Math.min(1.4, state.pitch));
    });
    window.addEventListener("wheel", (e) => {
      e.preventDefault();
      state.zoom = Math.max(4, Math.min(24, state.zoom - e.deltaY * 0.012));
    }, { passive: false });
    window.addEventListener("resize", resize);

    resize();
    setFromUI();
    restart();
    frame();
  </script>
</body>
</html>
