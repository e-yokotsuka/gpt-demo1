(()=>{var e={374:(e,t,a)=>{"use strict";var s=a(561);const i=["str","dex","con","intl","wiz","cha"],r=({diceText:e,status:t,isMinMax:a=!1})=>{const[s,r]=e.split("d").map((e=>e.split("+")[0]));let o=e.split("+");o.shift(),o=o.map((e=>t&&i.includes(e)?h(Number(t[e]),Number(t.modifiers[e])):e?Number(e):0));const c=o.reduce(((e,t)=>t+e),0);let p=c,l=c,d=c;if(n(e))for(let i=0;i<s;i++)p+=Math.floor(Math.random()*r),l+=1,d+=+r;return a?{minValue:l,maxValue:d}:p+o.slice(1).reduce(((e,t)=>e+t),0)},n=e=>/\b\d+d\d+\b/g.test(e),o=Math.floor(999/51),h=(e,t)=>Math.floor(e/o)+t,c=({diceText:e,status:t})=>r({diceText:e,status:t,isMinMax:!0}),p=(e,t)=>{const a=e.mapX-t.mapX,s=e.mapY-t.mapY;return Math.sqrt(a*a+s*s)};var l=a(353);const d=class{constructor(e){this.core=e}determineInitiative(e){return e.sort(((e,t)=>{const a=r({diceText:"1d20+dex",status:e});return r({diceText:"1d20+dex",status:t})-a}))}checkHit({offense:e,defense:t}){return r({diceText:"1d20+dex",status:e})>=r({diceText:"1d20+dex",status:t})}checkMagicHit({offense:e,defense:t}){return r({diceText:"1d20+intl",status:e})>=r({diceText:"1d20+intl",status:t})}weaponAttack({offense:e,defense:t}){const{weapon:a}=e.equipments,{armour:s,shield:i}=t.equipments;e.beforeAttack(a,t);if(!this.checkHit({offense:e,defense:t}))return void e.attackMissed(a);const n=r({diceText:`${a.value}+str`,status:e});let o=r({diceText:`${s.value}`,status:e});o+=r({diceText:`${i.value}+con`,status:e});const h=n-o;h>0?t.applyDamage({point:h,target:e}):t.blockAttack(e)}getRandomBonus(e,t){return Math.floor(Math.random()*(t-e+1))+e}calculateNextExp(e){return 100*Math.pow(e,2)}levelup({offense:e}){const{status:t,addText:a,characterName:s}=e;if(t.exp>=t.nextExp){t.lv++,a(`${s} \u306f ${t.lv} \u306b\u30ec\u30d9\u30eb\u30a2\u30c3\u30d7\uff01`),t.nextExp=t.exp+this.calculateNextExp(t.lv);const e=2+this.getRandomBonus(0,5+t.str/10),i=2+this.getRandomBonus(0,3+t.intl/10),r=2+this.getRandomBonus(0,3),n=2+this.getRandomBonus(0,3),o=2+this.getRandomBonus(0,3),h=2+this.getRandomBonus(0,3),c=2+this.getRandomBonus(0,3),p=2+this.getRandomBonus(0,3);t.maxHp+=e,t.maxMp+=i,t.str+=r,t.dex+=n,t.con+=o,t.intl+=h,t.wiz+=c,t.cha+=p,a(`${s}\u306e HP\u304c ${e} \u3042\u304c\u3063\u305f\uff01`),a(`${s}\u306e MP\u304c ${i} \u3042\u304c\u3063\u305f\uff01`),a(`${s}\u306e \u5f37\u3055\u304c ${r} \u3042\u304c\u3063\u305f\uff01`),a(`${s}\u306e \u4fca\u654f\u3055\u304c ${n} \u3042\u304c\u3063\u305f\uff01`),a(`${s}\u306e \u5f37\u976d\u3055\u304c ${o} \u3042\u304c\u3063\u305f\uff01`),a(`${s}\u306e \u77e5\u6027\u304c ${h} \u3042\u304c\u3063\u305f\uff01`),a(`${s}\u306e \u77e5\u6075\u304c ${c} \u3042\u304c\u3063\u305f\uff01`),a(`${s}\u306e \u30ab\u30ea\u30b9\u30de\u304c ${p} \u3042\u304c\u3063\u305f\uff01`)}}getEnemiesInRange=(e,t)=>{const a=this.findEnemiesInRange(e,t);return this.getApproachEnemys(e,a)};findEnemiesInRange=(e,t)=>{this.scene=this.scene||this.core.getScene(nt.GAME);return[...this.scene.getEnemys(),this.scene.getPlayer()].filter((a=>{const s=Math.abs(a.mapX-e.mapX),i=Math.abs(a.mapY-e.mapY);return s<=t&&i<=t&&a.uuid!=e.uuid}))};getApproachEnemys=(e,t)=>{if(!t.length)return[];const a=e.mapX,s=e.mapY,i=this.scene.currentMap;return t.map((e=>{if(this.isApproachEnemy({map:i,pMapX:a,pMapY:s,mMapX:e.mapX,mMapY:e.mapY}))return e})).filter((e=>void 0!==e)).sort(((e,t)=>Math.sqrt(Math.pow(e.mapX-a,2)+Math.pow(e.mapY-s,2))-Math.sqrt(Math.pow(t.mapX-a,2)+Math.pow(t.mapY-s,2))))};isApproachEnemy=({map:e,pMapX:t,pMapY:a,mMapX:s,mMapY:i})=>((t,a,s,i)=>{const r=Math.abs(s-t),n=Math.abs(i-a),o=t<s?1:-1,h=a<i?1:-1;let c=r-n;for(;;){if(e.getTile(t,a).isBlocked)return!1;if(t===s&&a===i)break;const p=2*c;p>-n&&(c-=n,t+=o),p<r&&(c+=r,a+=h)}return!0})(t,a,s,i)};const m=class{constructor({core:e,sceneId:t}){this.core=e,this.app=e.app,this.sound=l.eq,this.input=e.input,this.sceneId=t}getSceneId(){return this.sceneId}async Load(){return await!0}Initialize(){}main(){}async Start(){await!0}Stop(){}resize(){}onMute(){}};var u=a(460);const x=class{constructor(e,t){this.core=e,this.effects={},this.effectPrims={},this.container=t}async add(e={}){const t=Object.keys(e).map((async t=>{const{path:a,imageId:s}=e[t];try{const e=await fetch(a);if(!e.ok)throw new Error("Network response was not ok");return{key:t,json:await e.json(),imageId:s}}catch(i){return console.error("There has been a problem with your fetch operation:",i),{key:t,json:null,imageId:null}}}));(await Promise.all(t)).forEach((({key:e,json:t,imageId:a})=>{null!==t&&(t.imageId=a,this.effects[e]=t)}))}getParam(e){return this.effects[e]}setEffectPrim({key:e,x:t,y:a}){const s=this.getParam(e);e in this.effectPrims||(this.effectPrims[e]=[]);const i=new u.Bc({param:s,textures:this.core.textures.tx_main,x:t,y:a,isAutoDeserialize:!0});return this.effectPrims[e].push(i),this.container.addChild(i.getPrim()),i}update(e){Object.keys(this.effectPrims).forEach((t=>{this.effectPrims[t].forEach((t=>t.update(e))),this.effectPrims[t]=this.effectPrims[t].filter((e=>0==e.isDead))}))}},v=32,g=16777215,w=16737843;const y=class{constructor({x:e,y:t,width:a,height:s}){this.x=e,this.y=t,this.width=a,this.height=s}contains=({x:e,y:t,width:a,height:s})=>{const{x:i,y:r,width:n,height:o}=this;return e<=i+n&&i<=e+a&&t<=r+o&&r<=t+s};isTop({y:e,height:t}){const{y:a}=this;return e+t<=a}isBottom({y:e}){const{y:t,height:a}=this;return e>=t+a}isLeft({x:e,width:t}){const{x:a}=this;return e+t<=a}isRight({x:e}){const{x:t,width:a}=this;return e>=t+a}},f=(e,t)=>{const a=new y(e);return t.forEach((e=>{if(a.contains(e))return!0})),!1},M=(e,t)=>{for(const{x:a,y:s}of t)if(e.x===a||e.y===s)return!0;return!1},L=(e,t,a)=>{const s=[...e],i=e.filter((({type:e})=>"h"===e));i.forEach((({x:e,y:r,width:n,cellName:o},h)=>{let c=r,p=r,l=!1;const d=e+n;if(i.forEach((({x:e,y:t},a)=>{if(h===a)return;d===e&&(c=Math.min(c,t),p=Math.max(p,t),l=!0)})),l){if(0!==p-c){const e={x:d,y:c,width:1,height:p-c+1,type:"v",cellName:o};!f(e,t)&&M(e,a)&&s.push(e)}}}));const r=e.filter((({type:e})=>"v"===e));return r.forEach((({x:e,y:i,height:n,cellName:o},h)=>{let c=e,p=e,l=!1;const d=i+n;if(r.forEach((({x:e,y:t},a)=>{if(h===a)return;t===d&&(c=Math.min(c,e),p=Math.max(p,e),l=!0)})),l){if(0!==p-c){const e={x:c,y:d,width:p-c+1,height:1,type:"h",cellName:o};!f(e,t)&&M(e,a)&&s.push(e)}}})),s},k=e=>e.map((({x:e,y:t,width:a,height:s,direction:i})=>({r:{x:e,y:t,width:1,height:1,type:"entrancce"},l:{x:e+a,y:t,width:1,height:1,type:"entrancce"},t:{x:e,y:t+s,width:1,height:1,type:"entrancce"},b:{x:e,y:t,width:1,height:1,type:"entrancce"}}[i])));const T=class{constructor(e,t,a){this.item=a,this.core=e,this.scene=t,this.valueLabel="\u5024",this.use.bind(this)}use(){const{itemName:e}=this.item;this.addText(`\u3046\u30fc\u3093\u3001${e}\u306f\u4f7f\u3046\u3082\u3093\u3058\u3083\u3041\u306a\u3044\u306a`)}equipment(){const{itemName:e}=this.item;this.addText(`${e}\u306f\u3001\u88c5\u5099\u3067\u304d\u306a\u3044\uff01\u3060\u3044\u3058\u3087\u3046\u3076\u304b\uff1f`)}addText=e=>this.scene.addText(e);getStringValue(){return""}};const S=class extends T{constructor(e,t,a){super(e,t,a)}use(){const{itemName:e}=this.item;this.addText(`\u3046\u30fc\u3093\u3001${e}\u306f\u4f7f\u3046\u3082\u3093\u3058\u3083\u3041\u306a\u3044\u306a`)}equipment(e){const{item:t}=this,{itemName:a}=t;let s=t;e.isItemEquipped(t)?(e.equipment(H[0],_.armour),this.addText(`${a}\u3092\u8131\u3044\u3060\uff01\u3059\u3063\u304d\u308a\u3057\u305f\uff01`)):(e.equipment(s),this.addText(`${a}\u3092\u88c5\u7740\u3057\u305f\u305e\uff01`))}getStringValue(){const{item:e}=this;return`${e.value}`}};const N=class extends T{constructor(e,t,a){super(e,t,a),this.use.bind(this)}use=e=>{const{value:t}=this.item,{itemName:a}=this.item,{status:s}=e;if(s.maxHp<=s.hp)return Math.random()<=.1?(this.addText(`\u7121\u99c4\u306b${a}\u3092\u6d88\u8cbb\u3057\u305f\uff01\n\u3042\u306a\u305f\u306f\u3082\u3063\u3068\u982d\u3092\u4f7f\u3046\u3079\u304d\u3060\uff01`),!0):(this.addText("\u6b8b\u5ff5\uff01\u56de\u5fa9\u3059\u308b\u610f\u5473\u304c\u306a\u3044\uff01\n\u3042\u306a\u305f\u306f\u3053\u308c\u3063\u307d\u3061\u3082\u50b7\u3064\u3044\u3066\u3044\u306a\u3044\uff01"),!1);const i=r({diceText:t});return e.healHp(i,this.item),!0};getStringValue(e){const{item:t}=this;if(t.value.includes("%"))return t.value;const a=c({diceText:t.value,status:e});return`${a.minValue}\uff5e${a.maxValue}`}};const E=class extends T{constructor(e,t,a){super(e,t,a)}use(){const{itemName:e}=this.item;this.addText(`\u3046\u30fc\u3093\u3001${e}\u306f\u4f7f\u3046\u3082\u3093\u3058\u3083\u3041\u306a\u3044\u306a`)}equipment(e){const{item:t}=this,{itemName:a}=t;let s=t;e.isItemEquipped(t)?(e.equipment(H[0],_.ring),this.addText(`${a}\u3092\u305d\u3063\u3068\u5de6\u306e\u85ac\u6307\u304b\u3089\u306f\u305a\u3057\u305f\u3002\u5c11\u3057\u60b2\u3057\u304f\u306a\u3063\u305f\u3002`)):(e.equipment(s),this.addText(`${a}\u3092\u305d\u3063\u3068\u5de6\u306e\u85ac\u6307\u306b\u306f\u3081\u305f\u3002\u5c11\u3057\u3069\u304d\u3069\u304d\u3057\u305f\u3002`))}getStringValue(){const{item:e}=this;return`${e.value}`}};const C=class extends T{constructor(e,t,a){super(e,t,a)}use(){const{itemName:e}=this.item;this.addText(`\u3046\u30fc\u3093\u3001${e}\u306f\u4f7f\u3046\u3082\u3093\u3058\u3083\u3041\u306a\u3044\u306a`)}addText=e=>this.core.addText(e);getStringValue(){const{item:e}=this;return`${e.value}`}};const b=class extends T{constructor(e,t,a){super(e,t,a)}use(){const{itemName:e}=this.item;this.addText(`\u3046\u30fc\u3093\u3001${e}\u306f\u4f7f\u3046\u3082\u3093\u3058\u3083\u3041\u306a\u3044\u306a`)}equipment(e){const{item:t}=this,{itemName:a}=t;let s=t;e.isItemEquipped(t)?(e.equipment(H[0],_.shield),this.addText(`${a}\u3092\u5916\u3057\u305f\uff01`)):(e.equipment(s),this.addText(`${a}\u3092\u88c5\u5099\u3057\u305f\u305e\uff01`))}getStringValue(){const{item:e}=this;return`${e.value}`}};const R=class extends T{constructor(e,t,a){super(e,t,a)}use(){const{itemName:e}=this.item;this.addText(`\u3046\u30fc\u3093\u3001${e}\u306f\u4f7f\u3046\u3082\u3093\u3058\u3083\u3041\u306a\u3044\u306a`)}equipment(e){const{item:t}=this,{itemName:a}=t;let s=t;e.isItemEquipped(t)?(e.equipment(H[1],_.weapon),this.addText(`${a}\u3092\u5916\u3057\u305f\uff01`)):(e.equipment(s),this.addText(`${a}\u3092\u88c5\u5099\u3057\u305f\u305e\uff01`))}getStringValue(e){const{item:t}=this,a=c({diceText:t.value,status:e});return`${a.minValue}\uff5e${a.maxValue}`}},_={recovery:"recovery",weapon:"weapon",armour:"armour",shield:"shield",scroll:"scroll",ring:"ring",empty:"empty"},B={recovery:"\u56de\u5fa9\u7cfb",weapon:"\u6b66\u5668",armour:"\u93a7",shield:"\u76fe",scroll:"\u307e\u304d\u3082\u306e",ring:"\u6307\u8f2a",empty:"\u88c5\u5099\u3057\u3066\u3044\u307e\u305b\u3093"},P=[_.weapon,_.armour,_.shield,_.ring],H=[{id:"empty",uuid:"",itemName:"\u306a\u3057",itemType:_.empty,itemTypeName:B[_.empty],value:"0",valueLabel:"",price:0,rarity:0,minimumDepth:0,itemLogicClass:null},{id:"kobushi",uuid:"",itemName:"\u3053\u3076\u3057",itemType:_.empty,itemTypeName:B[_.empty],value:"1d4",valueLabel:"\u3053\u3076\u3057",price:0,rarity:0,minimumDepth:0,itemLogicClass:R},{id:"yakuso",uuid:"",itemName:"\u3088\u3086\u3061\u3087\u3093\u3076\u3063\u3061\u305d\u3046",itemType:_.recovery,itemTypeName:B[_.recovery],value:"1d6+2",valueLabel:"\u56de\u5fa9\u5024",price:4,rarity:1,minimumDepth:0,itemLogicClass:N},{id:"dagger",uuid:"",itemName:"\u30c0\u30ac\u30fc",itemType:_.weapon,itemTypeName:B[_.weapon],value:"1d4+2",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:4,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"leather-armor",uuid:"",itemName:"\u30ec\u30b6\u30fc\u30a2\u30fc\u30de\u30fc",itemType:_.armour,itemTypeName:B[_.armour],value:"11+dex",valueLabel:"\u9632\u5fa1\u529b",price:4,rarity:1,minimumDepth:0,itemLogicClass:S},{id:"potion",uuid:"",itemName:"\u56de\u5fa9\u30dd\u30fc\u30b7\u30e7\u30f3",itemType:_.recovery,itemTypeName:B[_.recovery],value:"2d4+2",valueLabel:"\u56de\u5fa9\u5024",price:8,rarity:1,minimumDepth:0,itemLogicClass:N},{id:"long-sword",uuid:"",itemName:"\u30ed\u30f3\u30b0\u30bd\u30fc\u30c9",itemType:_.weapon,itemTypeName:B[_.weapon],value:"1d8+3",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:10,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"chain-mail",uuid:"",itemName:"\u30c1\u30a7\u30a4\u30f3\u30e1\u30a4\u30eb",itemType:_.armour,itemTypeName:B[_.armour],value:"13+dex",valueLabel:"\u9632\u5fa1\u529b",price:12,rarity:1,minimumDepth:0,itemLogicClass:S},{id:"mana-potion",uuid:"",itemName:"\u30de\u30ca\u30dd\u30fc\u30b7\u30e7\u30f3",itemType:_.recovery,itemTypeName:B[_.recovery],value:"1d8+4",valueLabel:"\u56de\u5fa9\u5024",price:10,rarity:1,minimumDepth:0,itemLogicClass:N},{id:"shortbow",uuid:"",itemName:"\u30b7\u30e7\u30fc\u30c8\u30dc\u30a6",itemType:_.weapon,itemTypeName:B[_.weapon],value:"1d6+1",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:6,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"plate-armor",uuid:"",itemName:"\u30d7\u30ec\u30fc\u30c8\u30a2\u30fc\u30de\u30fc",itemType:_.armour,itemTypeName:B[_.armour],value:"18",valueLabel:"\u9632\u5fa1\u529b",price:20,rarity:1,minimumDepth:0,itemLogicClass:S},{id:"antidote",uuid:"",itemName:"\u89e3\u6bd2\u85ac",itemType:_.recovery,itemTypeName:B[_.recovery],value:"1",valueLabel:"\u56de\u5fa9\u5024",price:2,rarity:1,minimumDepth:0,itemLogicClass:N},{id:"greatsword",uuid:"",itemName:"\u30b0\u30ec\u30fc\u30c8\u30bd\u30fc\u30c9",itemType:_.weapon,itemTypeName:B[_.weapon],value:"2d6+4",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:15,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"crossbow",uuid:"",itemName:"\u30af\u30ed\u30b9\u30dc\u30a6",itemType:_.weapon,itemTypeName:B[_.weapon],value:"1d8+2",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:10,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"scale-armor",uuid:"",itemName:"\u30b9\u30b1\u30a4\u30eb\u30a2\u30fc\u30de\u30fc",itemType:_.armour,itemTypeName:B[_.armour],value:"14+dex",valueLabel:"\u9632\u5fa1\u529b",price:14,rarity:1,minimumDepth:0,itemLogicClass:S},{id:"elixir",uuid:"",itemName:"\u30a8\u30ea\u30af\u30b5\u30fc",itemType:_.recovery,itemTypeName:B[_.recovery],value:"full",valueLabel:"\u56de\u5fa9\u5024",price:25,rarity:1,minimumDepth:0,itemLogicClass:N},{id:"staff",uuid:"",itemName:"\u30b9\u30bf\u30c3\u30d5",itemType:_.weapon,itemTypeName:B[_.weapon],value:"1d6+1",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:5,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"shield",uuid:"",itemName:"\u30b7\u30fc\u30eb\u30c9",itemType:_.shield,itemTypeName:B[_.shield],value:"+2",valueLabel:"\u9632\u5fa1\u529b",price:8,rarity:1,minimumDepth:0,itemLogicClass:b},{id:"speed-potion",uuid:"",itemName:"\u901f\u3055\u306e\u30dd\u30fc\u30b7\u30e7\u30f3",itemType:_.recovery,itemTypeName:B[_.recovery],value:"1d4",valueLabel:"\u56de\u5fa9\u5024",price:7,rarity:1,minimumDepth:0,itemLogicClass:N},{id:"warhammer",uuid:"",itemName:"\u30a6\u30a9\u30fc\u30cf\u30f3\u30de\u30fc",itemType:_.weapon,itemTypeName:B[_.weapon],value:"1d8+3",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:12,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"splint-armor",uuid:"",itemName:"\u9a5a\u7570\u306e\u76fe",itemType:_.shield,itemTypeName:B[_.shield],value:"17",valueLabel:"\u9632\u5fa1\u529b",price:18,rarity:1,minimumDepth:0,itemLogicClass:b},{id:"revival-potion",uuid:"",itemName:"\u5fa9\u6d3b\u306e\u30dd\u30fc\u30b7\u30e7\u30f3",itemType:_.recovery,itemTypeName:B[_.recovery],value:"50%",valueLabel:"\u56de\u5fa9\u5024",price:20,rarity:1,minimumDepth:0,itemLogicClass:N},{id:"flail",uuid:"",itemName:"\u30d5\u30ec\u30a4\u30eb",itemType:_.weapon,itemTypeName:B[_.weapon],value:"1d8+2",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:10,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"ring-of-protection",uuid:"",itemName:"\u30d7\u30ed\u30c6\u30af\u30b7\u30e7\u30f3\u30ea\u30f3\u30b0",itemType:_.ring,itemTypeName:B[_.ring],value:"+1",valueLabel:"\u56de\u5fa9\u5024",price:15,rarity:1,minimumDepth:0,itemLogicClass:E},{id:"fire-scroll",uuid:"",itemName:"\u706b\u306e\u30b9\u30af\u30ed\u30fc\u30eb",itemType:_.scroll,itemTypeName:B[_.scroll],value:"2d6",valueLabel:"\u653b\u6483\u529b",price:5,rarity:1,minimumDepth:0,itemLogicClass:C},{id:"ice-scroll",uuid:"",itemName:"\u6c37\u306e\u30b9\u30af\u30ed\u30fc\u30eb",itemType:_.scroll,itemTypeName:B[_.scroll],value:"1d10",valueLabel:"\u653b\u6483\u529b",price:5,rarity:1,minimumDepth:0,itemLogicClass:C},{id:"thunder-scroll",uuid:"",itemName:"\u96f7\u306e\u30b9\u30af\u30ed\u30fc\u30eb",itemType:_.scroll,itemTypeName:B[_.scroll],value:"2d4+2",valueLabel:"\u653b\u6483\u529b",price:5,rarity:1,minimumDepth:0,itemLogicClass:C},{id:"mace",uuid:"",itemName:"\u30e1\u30a4\u30b9",itemType:_.weapon,itemTypeName:B[_.weapon],value:"1d6+2",valueLabel:"\u30c0\u30e1\u30fc\u30b8",price:8,rarity:1,minimumDepth:0,itemLogicClass:R},{id:"ring-of-strength",uuid:"",itemName:"\u529b\u306e\u30ea\u30f3\u30b0",itemType:_.ring,itemTypeName:B[_.ring],value:"+2",valueLabel:"\u653b\u6483\u529b\u52a0\u7b97",price:12,rarity:1,minimumDepth:0,itemLogicClass:E},{id:"ring-of-dexterity",uuid:"",itemName:"\u654f\u6377\u306e\u30ea\u30f3\u30b0",itemType:_.ring,itemTypeName:B[_.ring],value:"+2",valueLabel:"\u4fca\u654f\u5024\u52a0\u7b97",price:12,rarity:1,minimumDepth:0,itemLogicClass:E},{id:"ring-of-intelligence",uuid:"",itemName:"\u77e5\u6027\u306e\u30ea\u30f3\u30b0",itemType:_.ring,itemTypeName:B[_.ring],value:"+2",valueLabel:"\u77e5\u6027\u52a0\u7b97",price:12,rarity:1,minimumDepth:0,itemLogicClass:E},{id:"ring-of-constitution",uuid:"",itemName:"\u4f53\u529b\u306e\u30ea\u30f3\u30b0",itemType:_.ring,itemTypeName:B[_.ring],value:"+20",valueLabel:"\u4f53\u529b\u6700\u5927\u5024\u52a0\u7b97",price:12,rarity:1,minimumDepth:0,itemLogicClass:E}],$=[{id:"toge",name:"\u3068\u3052",description:"\u30c8\u30b2\u304c\u3068\u3073\u3060\u3057\u3066\u304f\u308b",dmg:"1d4+2",difficulty:"5",rarity:1,minimumDepth:0},{id:"togetoge",name:"\u30c8\u30b2\u30c8\u30b2",description:"\u30c8\u30b2\u304c2\u672c\u3068\u3073\u3060\u3057\u3066\u304f\u308b",dmg:"2d4+3",difficulty:"10",rarity:1,minimumDepth:0},{id:"togetogetoge",name:"\u68d8\u30c8\u30b2\u30c8\u30b2",description:"\u30c8\u30b2\u306e\u5148\u304b\u3089\u30c8\u30b2\u304c2\u672c\u3068\u3073\u3060\u3057\u3066\u304f\u308b",dmg:"3d4+4",difficulty:"15",rarity:1,minimumDepth:0},{id:"poison-gas",name:"\u6bd2\u30ac\u30b9",description:"\u6bd2\u30ac\u30b9\u304c\u90e8\u5c4b\u306b\u5145\u6e80\u3059\u308b",dmg:"1d6+2",difficulty:"8",rarity:.8,minimumDepth:2},{id:"pitfall",name:"\u843d\u3068\u3057\u7a74",description:"\u8db3\u5143\u306b\u7a81\u7136\u7a74\u304c\u7a7a\u304f",dmg:"2d4+1",difficulty:"12",rarity:.7,minimumDepth:3},{id:"explosive-rune",name:"\u7206\u767a\u306e\u30eb\u30fc\u30f3",description:"\u5e8a\u306b\u63cf\u304b\u308c\u305f\u30eb\u30fc\u30f3\u304c\u7a81\u7136\u7206\u767a\u3059\u308b",dmg:"3d6",difficulty:"14",rarity:.6,minimumDepth:4},{id:"spike-pit",name:"\u30b9\u30d1\u30a4\u30af\u30d4\u30c3\u30c8",description:"\u5e95\u306b\u30b9\u30d1\u30a4\u30af\u306e\u3042\u308b\u6df1\u3044\u7a74\u306b\u843d\u3061\u308b",dmg:"2d6+4",difficulty:"18",rarity:.5,minimumDepth:5},{id:"fire-trap",name:"\u706b\u708e\u7f60",description:"\u7a81\u7136\u3001\u58c1\u304b\u3089\u706b\u708e\u304c\u5439\u304d\u51fa\u3059",dmg:"4d4",difficulty:"16",rarity:.4,minimumDepth:6},{id:"lightning-trap",name:"\u96f7\u6483\u7f60",description:"\u5929\u4e95\u304b\u3089\u96f7\u304c\u964d\u308a\u6ce8\u3050",dmg:"3d6+3",difficulty:"20",rarity:.3,minimumDepth:7},{id:"blade-trap",name:"\u5203\u306e\u7f60",description:"\u5e8a\u304b\u3089\u92ed\u3044\u5203\u304c\u98db\u3073\u51fa\u3059",dmg:"1d10+5",difficulty:"22",rarity:.2,minimumDepth:8},{id:"curse-trap",name:"\u546a\u3044\u306e\u7f60",description:"\u4e0d\u6c17\u5473\u306a\u30aa\u30fc\u30e9\u304c\u30d7\u30ec\u30a4\u30e4\u30fc\u3092\u5305\u307f\u8fbc\u3080",dmg:"1d4-1",difficulty:"25",rarity:.1,minimumDepth:9}],G=({width:e,height:t,retry:a=0})=>{if(a>5)return[{x:0,y:0,width:e,height:t,parent:!1}];const s=.4+Math.random()*(.6-.4),i=e>t?{length:e,sublength:t,target:"x",subtarget:"y",primary:"width",secondary:"height"}:{length:t,sublength:e,target:"y",subtarget:"x",primary:"height",secondary:"width"},{length:r,sublength:n,target:o,subtarget:h,primary:c,secondary:p}=i,l=Math.round(r*s),d=r-l;if(l<8||d<8)return G({width:e,height:t,retry:a+1});const m=l*n,u=d*n;return[{[o]:0,[h]:0,[c]:l,[p]:n,parent:m>=u},{[o]:l,[h]:0,[c]:d,[p]:n,parent:m<u}]},D=({rectArray:e,maxRoom:t})=>{if(--t<=0)return e;const a=e.map((e=>e.parent?G({width:e.width,height:e.height}).map((t=>(t.x+=e.x,t.y+=e.y,t))):e)).flat();return D({rectArray:a,maxRoom:t})},A=({map:e,maxRoom:t=6})=>{const a=e.length,s=e[0].length;return D({rectArray:[{x:0,y:0,width:s,height:a,parent:!0}],width:s,height:a,maxRoom:t})},I=({roomArray:e,xorArray:t,isUp:a=!1,maxStairs:s=3,probability:i=.5,force:r=!1})=>{const n=(e,a)=>(t.forEach((({x:t,y:s})=>{if(t===e&&s===a)return!0})),!1),o=r?s:Math.max(Math.floor(Math.random()*s),1),h=[];for(;h.length!==o;){if(!r&&Math.random()>i)continue;const t=e[Math.floor(Math.random()*e.length)],s=Math.floor(Math.random()*(t.width-2))+1+t.x,o=Math.floor(Math.random()*(t.height-2))+1+t.y;n(s,o)||(h.find((({x:e,y:t})=>s===e&&o===t))||h.push({x:s,y:o,isUp:a,next:{}}))}return h},W=(e,t,a=[],s=10,i=.5)=>{if(!a?.length)return[];const r=(e,a)=>(t.forEach((({x:t,y:s})=>{if(t===e&&s===a)return!0})),!1),n=Math.floor(Math.random()*s),o=[];return e.forEach((e=>{for(let t=0;t<n;t++){if(Math.random()>i)continue;const t=Math.floor(Math.random()*(e.width-2))+1+e.x,s=Math.floor(Math.random()*(e.height-2))+1+e.y;if(r(t,s))continue;const n=Math.floor(Math.random()*a.length),h=a[n];o.push({x:t,y:s,trap:h})}})),o},X=(e,t,a=[],s=5,i=.3,r=1)=>{if(!a?.length)return[];const n=(e=>e.filter((e=>e.itemType!=_.empty)))(a),o=(e,a)=>{for(const{x:s,y:i}of t)if(Math.abs(s-e)+Math.abs(i-a)===1)return!0;return!1},h=Math.floor(Math.random()*s),c=[];return e.forEach((e=>{for(let t=0;t<h;t++){if(Math.random()>i)continue;const t=Math.floor(Math.random()*(e.width-2))+1+e.x,a=Math.floor(Math.random()*(e.height-2))+1+e.y;if(o(t,a))continue;const s=Math.floor(Math.random()*n.length),h=Math.random()<r?n[s]:null;c.push({x:t,y:a,item:h})}})),c},Y=(e,t,a,s,i)=>{const r=s-3;return{x:e,width:a-e,y:t+Math.round(Math.random()*r)+1,height:1,type:"h",direction:i,cellName:"floor_vines4"}},q=(e,t,a,s,i)=>{const r=s-3;return{x:e+Math.round(Math.random()*r)+1,width:1,y:t,height:a-t,type:"v",direction:i,cellName:"floor_vines4"}},O=(e,t)=>{const a=[],s=(e=>{const t=[];return e.forEach(((a,s)=>{const i={isTop:!1,isLeft:!1,isRight:!1,isBottom:!1};e.forEach(((e,t)=>{if(s===t)return;const r=new y(a);i.isTop=!!i.isTop||r.isTop(e),i.isLeft=!!i.isLeft||r.isLeft(e),i.isBottom=!!i.isBottom||r.isBottom(e),i.isRight=!!i.isRight||r.isRight(e)})),t.push(i)})),t})(e);return t.forEach(((t,i)=>{const r=e[i],n=s[i];if(n.isRight){const e=t.x+t.width,s=r.x+r.width;a.push(Y(e,t.y,s,t.height,"r"))}if(n.isLeft){const e=r.x,s=t.x;a.push(Y(e,t.y,s,t.height,"l"))}if(n.isTop){const e=r.y,s=t.y;a.push(q(t.x,e,s,t.width,"t"))}if(n.isBottom){const e=t.y+t.height,s=r.y+r.height;a.push(q(t.x,e,s,t.width,"b"))}})),a},z=["floor_vines0","floor_vines1","floor_vines2","floor_vines3","floor_vines4","floor_vines5","floor_vines6","floor_sand_stone0","floor_sand_stone1","floor_sand_stone2","floor_sand_stone3"],U=(e,t=0)=>{const a=Math.floor(Math.random()*z.length);if(t>5)return{x:e.x+2,y:e.y+2,width:e.width-4,height:e.height-4,cellName:z[a]};const s=Math.round(6*Math.random())+2,i=Math.round(6*Math.random())+2,r=Math.round((.8+Math.random()/5)*e.width)-4,n=Math.round((.8+Math.random()/5)*e.height)-4,o={x:e.x+s,y:e.y+i,width:r-s,height:n-i,cellName:z[a]};return o.width<=4||o.height<=4?U(e,t+1):o},j=e=>e.map((e=>U(e))),V=e=>e.map((e=>(({x:e,y:t,width:a,height:s})=>[{x:e,y:t,width:a,height:1,cellName:"stone_brick1"},{x:e,y:t,width:1,height:s,cellName:"stone_brick1"},{x:e+a,y:t,width:1,height:s,cellName:"stone_brick1"},{x:e,y:t+s,width:a+1,height:1,cellName:"stone_brick1"}])(e))).flat(),F=({core:{textures:{tx_main:e}},name:t})=>{const a=new s.jyi(e[`${t}`]);return a.interactive=!1,a};const K=class{constructor({core:e,x:t,y:a,cellName:s="travel_exclusion",type:i="none",isBlocked:r=!1,prim:n}){console.assert(e),this.core=e,this.x=t,this.y=a,this.cellName=s,this.type=i,this.isBlocked=r,this.prim=n,this.hitStep=0}changeTexture(e){this.prim.texture=this.core.getTexture(e)}hit=e=>this.isBlocked;initPrim(){return this.prim=F({core:this.core,name:this.cellName}),this.prim}serialize(){const e={};return["x","y","cellName","type","isBlocked","hitStep"].forEach((t=>e[t]=this[t])),e}};const Z=class extends K{constructor({core:e,x:t,y:a}){super({core:e,x:t,y:a,cellName:"blank",type:"blank",isBlocked:!0})}};const J=class extends K{constructor({core:e,x:t,y:a,item:s,floor:i}){super({core:e,x:t,y:a,cellName:s?"chest2_closed":"chest2_open",type:"chest",isBlocked:!0}),this.item=s,this.floor=i}initPrim(){const e=new s.W20;return e.addChild(this.floor.initPrim()),this.chestPrim=F({core:this.core,name:this.cellName}),e.addChild(this.chestPrim),e}changeTexture(e){this.chestPrim.texture=this.core.getTexture(e)}hit=({actor:e=null,status:t})=>{const{item:a,hitStep:s}=this;return a?s+1==t.steps?(this.cellName="chest2_open",this.changeTexture("chest2_open"),this.item=null,e.getItem(a)):(this.hitStep=t.steps,e.discoverChest()):e.discoverEmptyChest(),this.isBlocked};serialize(){return{...super.serialize(),item:this.item}}};const Q=class extends K{constructor({core:e,x:t,y:a}){const s="dngn_closed_door";super({core:e,x:t,y:a,cellName:s,type:"door",isBlocked:!0,prim:F({core:e,name:s})}),this.close=!0}hit=({actor:e=null,status:t})=>{if(!this.close)return this.isBlocked;const{close:a,hitStep:s}=this;return s+1==t.steps&&a?(this.close=!1,this.isBlocked=!1,this.changeTexture("dngn_open_door"),e.openDoor(this)):(this.hitStep=t.steps,e.discoverDoor(this)),this.isBlocked};serialize(){return{...super.serialize(),close:this.close}}};const ee=class extends K{constructor({core:e,x:t,y:a,cellName:s}){super({core:e,x:t,y:a,cellName:s,type:"floor",isBlocked:!1})}};const te=class extends K{constructor({core:e,x:t,y:a,cellName:s}){super({core:e,x:t,y:a,cellName:s,type:"road",isBlocked:!1})}};const ae=class extends K{constructor({core:e,x:t,y:a,isUp:s=!0,next:i={},floor:r}){super({core:e,x:t,y:a,cellName:s?"stone_stairs_up":"stone_stairs_down",type:"stairs",isBlocked:!0}),this.next=i,this.isUp=s,this.floor=r}initPrim(){const e=new s.W20;return e.addChild(this.floor.initPrim()),this.stairsPrim=F({core:this.core,name:this.cellName}),e.addChild(this.stairsPrim),e}hit=({actor:e=null,status:t})=>(this.isUp?e.goToPrevLevel(this):e.goToNextLevel(this),this.isBlocked);serialize(){return{...super.serialize(),isUp:this.isUp,next:this.next}}setNext=e=>{this.next=e}};const se=class extends K{constructor({core:e,x:t,y:a,trap:s,floor:i}){super({core:e,x:t,y:a,cellName:"floor_vines0",type:"trap",isBlocked:!1}),this.trap=s,this.active=!0,this.floor=i}initPrim(){const e=new s.W20;return e.addChild(this.floor.initPrim()),this.trapPrim=F({core:this.core,name:this.cellName}),e.addChild(this.trapPrim),e}changeTexture(e){this.trapPrim.texture=this.core.getTexture(e)}hit=({actor:e})=>{if(!this.active)return this.isBlocked;const{trap:t}=this;return e.trappedIn(t)?(this.active=!1,this.cellName="dngn_trap_magical",this.changeTexture("dngn_trap_magical")):e.escapeTrap(),this.isBlocked}};const ie=class extends K{constructor({core:e,x:t,y:a,cellName:s}){super({core:e,x:t,y:a,cellName:s,type:"wall",isBlocked:!0})}};const re=class{constructor({core:e,scene:t,level:a,width:i=100,height:r=50}){this.map=null,this.isDebugViewCollision=!1,this.core=e,this.scene=t,this.level=a,this.width=i,this.height=r,this.lastMapX=0,this.lastMapY=0,this.resetCallback=[],this.stairs=[],this.mapContainer=new s.W20,this.makeAutomap()}getPrim=e=>this.mapContainer;getPosition=e=>({x:this.mapContainer.x,y:this.mapContainer.y});makeAutomap=e=>{const{scene:{core:t}}=this;this.fill((({x:e,y:t})=>new Z({x:e,y:t}))),this.rectArray=A({map:this.map,maxRoom:Math.round(10*Math.random()+2)}),this.roomArray=j(this.rectArray),this.roomWallArray=V(this.roomArray),this.roadArray=O(this.rectArray,this.roomArray),this.entranceArray=k(this.roadArray),this.roadArray2=L(this.roadArray,this.roomArray,this.rectArray),this.tresureBoxes=X(this.roomArray,this.entranceArray,H),this.traps=W(this.roomArray,this.tresureBoxes,$),this.downStairs=8===this.level?[]:I({roomArray:this.roomArray,xorArray:this.tresureBoxes}),this.upStairs=[],this.rectArray.forEach((({x:e,y:a,width:s,height:i})=>this.fillTilesInRect({x:e,y:a,width:s,height:i,fnTile:({x:e,y:a})=>new Z({core:t,x:e,y:a})}))),this.roomArray.forEach((({x:e,y:a,width:s,height:i,cellName:r})=>this.fillTilesInRect({x:e,y:a,width:s,height:i,fnTile:({x:e,y:a})=>new ee({core:t,x:e,y:a,cellName:r})}))),this.roomWallArray.forEach((({x:e,y:a,width:s,height:i,cellName:r})=>this.fillTilesInRect({x:e,y:a,width:s,height:i,fnTile:({x:e,y:a})=>new ie({core:t,x:e,y:a,cellName:r})}))),this.roadArray2.forEach((({x:e,y:a,width:s,height:i,cellName:r})=>this.fillTilesInRect({x:e,y:a,width:s,height:i,fnTile:({x:e,y:a})=>new te({core:t,x:e,y:a,cellName:r})}))),this.entranceArray.forEach((({x:e,y:a,width:s,height:i})=>this.fillTilesInRect({x:e,y:a,width:s,height:i,fnTile:({x:e,y:a})=>new Q({core:t,x:e,y:a})}))),this.tresureBoxes.forEach((({x:e,y:a,item:s})=>this.putTile(new J({core:t,x:e,y:a,item:s,floor:this.getTile(e,a)})))),this.traps.forEach((({x:e,y:a,trap:s})=>this.putTile(new se({core:t,x:e,y:a,trap:s,floor:this.getTile(e,a)})))),this.downStairs.forEach((({x:e,y:a,isUp:s})=>this.putTile(new ae({core:t,x:e,y:a,isUp:s,floor:this.getTile(e,a)})))),this.reset()};makeStairs=e=>{if(8===this.level)return;const t=e[this.level+1],{downStairs:a,core:s}=this;t.upStairs=I({roomArray:t.roomArray,xorArray:[...t.tresureBoxes,...t.downStairs],maxStairs:a.length,isUp:!0,force:!0}),t.upStairs.forEach((({x:e,y:i,isUp:r},n)=>{console.assert(t.upStairs.length===a.length);const o=this.downStairs[n],h=this.getTile(o.x,o.y);h.setNext({x:e,y:i,level:t.level}),this.putTile(h),t.putTile(new ae({core:s,x:e,y:i,isUp:r,next:{x:o.x,y:o.y,level:this.level},floor:t.getTile(e,i)}))})),t.reDraw()};fill=(e=(e=>{}))=>{const{width:t,height:a}=this;this.map=[...Array(a)].map(((a,s)=>Array(t).map(((t,a)=>e({x:a,y:s})))))};fillTilesInRect=({x:e,y:t,width:a,height:s,fnTile:i=(e=>{})})=>{for(let r=t;r<t+s;r++)for(let t=e;t<e+a;t++)this.map[r][t]=i({nx:t,ny:r})};putTile=e=>this.map[e.y][e.x]=e;putTileWithAttributes=({x:e,y:t,cellName:a,attributes:s={}})=>{this.map[t][e].prim&&(this.map[t][e].prim.texture=this.core.getTexture(a)),this.map[t][e].cellName=a,this.map[t][e]={...this.map[t][e],...s}};addResetCallback=e=>{this.resetCallback.push(e)};reset=e=>{this.reDraw(),this.resetCallback.forEach((e=>e()))};reDraw=e=>{const{map:t,mapContainer:a}=this;a.removeChildren(),t.forEach(((e,s)=>{e.forEach(((e,i)=>{const r=e.initPrim();r.x=i*r.width,r.y=s*r.height,t[s][i].prim=r,a.addChild(r)}))}))};_debugMapText=e=>{const{map:t}=this;let a="";t.forEach((e=>{let t="";e.forEach((({cellName:e})=>{t=`${t}|${e}`})),a=`${a}${t}\n`})),console.log(a)};isBlocked=(e,t)=>this.map[t][e].isBlocked;isBlockedTile=(e,t)=>!!this.map[t][e].isBlocked&&this.map[t][e];isActionTile=(e,t)=>!!this.map[t][e].isAction&&this.map[t][e];getTile=(e,t)=>this.map[t][e];update=e=>{const{core:{input:t},mapContainer:a}=this,s=v*e;t.isDown("j")&&(a.y-=s),t.isDown("u")&&(a.y+=s),t.isDown("k")&&(a.x-=s),t.isDown("h")&&(a.x+=s)};getRespawnPosition=(e=0)=>{const{roomArray:t}=this,a=t[Math.floor(Math.random()*t.length)],s=a.x+Math.floor(Math.random()*(a.width-2))+1,i=a.y+Math.floor(Math.random()*(a.height-2))+1;return this.map[i][s].isBlocked&&e<100?this.getRespawnPosition(e+1):{x:s,y:i}};center=(e,t)=>{const a=e||this.lastMapX,s=t||this.lastMapY,{core:i,mapContainer:r}=this,{width:n,height:o}=i.getCanvasSize();r.x=-a*v+n/2,r.y=-s*v+o/2,this.lastMapX=a,this.lastMapY=s};serialize(){const e={};this.map.forEach(((t,a)=>{const s=[];t.forEach(((e,t)=>{s[t]=e.serialize()})),e[a]=s})),console.log(JSON.stringify(e)),console.log("map \u306e\u4fdd\u5b58\u3092\u304a\u3053\u306a\u3046")}};const ne=class{constructor({core:e,scene:t}){this.isDebugViewCollision=!1,this.core=e,this.scene=t,this.levelMap=[],this.makeLevelMap()}makeLevelMap=e=>{const{core:t}=this,a=this;Array.from({length:9},((e,s)=>{this.levelMap.push(new re({core:t,scene:a,level:s}))})),this.afterProcessing()};createAndConnectStairs=e=>{this.levelMap.forEach((e=>e.makeStairs(this.levelMap)))};afterProcessing=e=>{this.createAndConnectStairs()};getLevelMap=e=>this.levelMap[Math.min(8,Math.max(0,e))]},oe={value:"male",name:"\u7537\u6027"},he={value:"female",name:"\u5973\u6027"},ce={value:"neutral",name:"\u4e2d\u6027"},pe={unknown:{value:"unknown"},human:{value:"human"},elf:{value:"elf"},celestial:{value:"celestial"},amorphous:{value:"amorphous"},humanoid:{value:"humanoid"},fey:{value:"fey"},beast:{value:"beast"},giant:{value:"giant"}};var le=a(721);const de="friendly",me="aggressive",ue="very_aggressive",xe=({lv:e=1,characterName:t,isPlayer:a=!1,currentBehavior:s=de,exp:i=0,nextExp:r=200,expReward:n,targetsIds:o=[],hp:h=0,mp:c=0,virtualX:p=0,virtualY:l=0,mapX:d=0,mapY:m=0,maxHp:u=0,maxMp:x=0,isStay:v=!1,lock:g=!1,str:w=10,dex:y=10,con:f=10,intl:M=10,wiz:L=10,cha:k=10,modifiers:T={str:0,dex:0,con:0,intl:0,wiz:0,cha:0},gender:S=oe.value,race:N=pe.human,force_update:E=!1,speed:C=1})=>({uuid:(0,le.Z)(),lv:e,characterName:t,isPlayer:a,currentBehavior:s,exp:i,nextExp:r,expReward:n,targetsIds:o,hp:h,mp:c,maxHp:u,maxMp:x,isStay:v,lock:g,str:w,dex:y,con:f,intl:M,wiz:L,cha:k,modifiers:T,gender:S,race:N,virtualX:p,virtualY:l,mapX:d,mapY:m,items:[],isDie:!1,equipments:{armour:H[0],weapon:H[1],ring:H[0],shield:H[0]},magics:{black:[],white:[]},steps:0,speed:C,walkCounter:0,force_update:E}),ve={[xe.FRIENDLY]:{attackPlayers:!1,attackMonsters:!1},[xe.AGGRESSIVE]:{attackPlayers:!0,attackMonsters:!1},[xe.VERY_AGGRESSIVE]:{attackPlayers:!0,attackMonsters:!0}};const ge=class{constructor(e){const t=xe({...e}),a=Object.keys(t);for(const s of a)this[s]=s in e?e[s]:t[s];this.isTeleportation=!1}trialMove=(e=".")=>{if(this.lock)return;if(this.walkCounter+=this.speed,this.walkCounter<1)return;this.walkCounter=(this.walkCounter-1)%this.speed;const{mapX:t,mapY:a}=this;let s=t,i=a;const r={l:e=>s=t-1,r:e=>s=t+1,u:e=>i=a-1,d:e=>i=a+1,".":e=>e};console.assert(r[e],`The specified movement direction code '${e}' does not exist. `),r[e]?.(),this.virtualX=s,this.virtualY=i};moveConfirmed=e=>{this.mapX=this.virtualX,this.mapY=this.virtualY};teleportation=(e,t)=>{this.mapX=this.virtualX=e,this.mapY=this.virtualY=t,this.force_update=!1,this.isTeleportation=!0};stay({force:e=!1}){e?this.force_update=!0:this.isStay=!0}lock(){this.lock=!0}unlock(){this.lock=!1}isLock(){return this.lock}equipment(e,t){const a={[_.weapon]:t=>this.equipments.weapon=e,[_.armour]:t=>this.equipments.armour=e,[_.shield]:t=>this.equipments.shield=e,[_.ring]:t=>this.equipments.ring=e}[t||e.itemType];a&&a(),this.stay({force:!0})}getEquipments=e=>this.equipments;canEquip=e=>P.includes(e.itemType);isItemEquipped(e){const t={[_.weapon]:t=>this.equipments.weapon.uuid==e.uuid,[_.armour]:t=>this.equipments.armour.uuid==e.uuid,[_.shield]:t=>this.equipments.shield.uuid==e.uuid,[_.ring]:t=>this.equipments.ring.uuid==e.uuid}[e.itemType];return t&&t()}isMove=e=>this.force_update||this.isStay||this.virtualX!==this.mapX||this.virtualY!==this.mapY;beforeUpdate=e=>{this.force_update||(this.isStay=!1,this.virtualX=this.mapX,this.virtualY=this.mapY)};afterUpdate=e=>{this.force_update=!1,this.isTeleportation=!1};getBehaviorPatterns=e=>ve[this.currentBehavior];serialize(){const e=xe({}),t=Object.keys(e),a={};for(const s of t)a[s]=this[s];return JSON.stringify(a)}};const we=class extends ge{constructor(){super({characterName:"\u3086\u30fc\u3057\u3083",isPlayer:!0,lv:1,hp:30,mp:300,maxHp:30,maxMp:300,gender:oe.value,race:pe.human,equipments:{armour:H[0],weapon:H[1],ring:H[0],shield:H[0]},position:{x:0,y:0},speed:1,steps:0,items:[]})}};const ye=class{constructor(e,t,a){this.magic=a,this.core=e,this.scene=t,this.valueLabel="\u5024",this.logicHandler=()=>{},this.use.bind(this)}use=e=>{const{mp:t}=this.magic,{status:a}=e;if(a.mp<=t)return this.addText("\u6b8b\u5ff5\uff01MP\u304c\u8db3\u308a\u306a\u3044\uff01"),!1;const s=this.logicHandler(e);return e.useMp(s),!0};addText=e=>this.scene.addText(e);getStringValue(){return""}effects(){console.log("ML Effects")}};const fe=class extends ye{constructor(e,t,a){super(e,t,a),this.use.bind(this),this.logicHandler=e=>{const{value:a,mp:s}=this.magic,i=t.getPlayer(),n=t.getEnemiesInRange(i,10);for(const o of n){const e=r({diceText:a,status:i});t.showEffect({key:"fireboll",x:o.cx,y:o.cy}),o.applyDamage({point:e,target:i}),this.addText(`X: ${o.mapX} Y:${o.mapY}MP:${s}DAMAGE:${e}`);break}return s}}getStringValue(e){const{magic:t}=this;if(t.value.includes("%"))return t.value;const a=c({diceText:t.value,status:e});return`${a.minValue}\uff5e${a.maxValue}`}};const Me=class extends ye{constructor(e,t,a){super(e,t,a),this.use.bind(this),this.logicHandler=e=>{const{value:t,mp:a}=this.magic,{status:s}=e;if(s.maxHp<=s.hp)return Math.random()<=.1?(e.useMp(a),this.addText("\u7121\u99c4\u306bMP\u3092\u6d88\u8cbb\u3057\u305f\uff01\n\u3042\u306a\u305f\u306f\u3082\u3063\u3068\u982d\u3092\u4f7f\u3046\u3079\u304d\u3060\uff01"),a):(this.addText("\u6b8b\u5ff5\uff01\u56de\u5fa9\u3059\u308b\u610f\u5473\u304c\u306a\u3044\uff01\n\u3042\u306a\u305f\u306f\u3053\u308c\u3063\u307d\u3061\u3082\u50b7\u3064\u3044\u3066\u3044\u306a\u3044\uff01"),0);const i=r({diceText:t});return e.healHp(i,this.magic),a}}getStringValue(e){const{magic:t}=this;if(t.value.includes("%"))return t.value;const a=c({diceText:t.value,status:e});return`${a.minValue}\uff5e${a.maxValue}`}},Le="recovery",ke="attack",Te="white",Se="black",Ne={white:"\u767d\u9b54\u6cd5",black:"\u9ed2\u9b54\u6cd5"},Ee={recovery:"\u56de\u5fa9\u7cfb",attack:"\u653b\u6483\u7cfb",defance:"\u9632\u5fa1\u7cfb",effect:"\u52b9\u679c\u7cfb",tool:"\u30c4\u30fc\u30eb\u7cfb"},Ce=[{id:"heal1",uuid:"",level:1,magicName:"\u30ab\u30a4\u30d5\u30ad\u30e5\u30fc",magicAttribute:Te,magicType:Le,magicTypeName:Ee[Le],value:"1d6+2",valueLabel:"\u56de\u5fa9\u5024",mp:4,magicLogicClass:Me},{id:"heal2",uuid:"",level:2,magicName:"\u30ab\u30a4\u30d5\u30ad\u30e5\u30ad\u30e5\u30fc",magicAttribute:Te,magicType:Le,magicTypeName:Ee[Le],value:"1d8+2",valueLabel:"\u56de\u5fa9\u5024",mp:4,magicLogicClass:Me},{id:"fireboll",uuid:"",level:2,range:5,magicName:"\u30d5\u30a1\u30a4\u30e4\u30fc\u30dc\u30fc\u30eb",magicAttribute:Se,magicType:ke,magicTypeName:Ee[ke],value:"2d10+intl",valueLabel:"\u706b\u708e\u30c0\u30e1\u30fc\u30b8",mp:4,magicLogicClass:fe}];const be=class{constructor(e,t){this.core=e,this.scene=t,this.container=new s.W20,this.texts=[]}addDisplayPoint({x:e=0,y:t=0,pointText:a}){const i=new s.xvT(`${a}`,{fontSize:40,fill:16777215,align:"center",stroke:"#000000",strokeThickness:2});i.anchor.set(.5),i.x=e,i.y=t,this.texts.push({text:i,subY:5,destroyed:!1}),this.container.addChild(i)}getPrim=e=>this.container;update=e=>{this.texts.forEach((({text:t,subY:a},s)=>{const i=a*e;t.y-=i,t.alpha*=.95,(a*=.95)<1&&(t.destroy(),this.texts[s].destroyed=!0),this.texts[s].subY=a})),this.texts=this.texts.filter((e=>!e.destroyed))}};const Re=class{constructor({core:e,scene:t,status:a}){this.core=e,this.scene=t,this.status=a,this.ui_DIsplayPoint=new be(e,this),this.container=new s.W20,this.uiContainer=new s.W20,this.uiContainer.addChild(this.ui_DIsplayPoint.getPrim()),this.mainContainer=new s.W20,this.mainContainer.addChild(this.container),this.mainContainer.addChild(this.uiContainer),this.mainContainer.interactive=!0,this.mainContainer.on("click",(e=>{const{uuid:t,characterName:a,hp:s,maxHp:i,mp:r,maxMp:n,status:{targetsIds:o}}=this;this.core.setDebugText(4,`name :${a} hp:${s}/${i} mp:${r}/${n}`),this.core.setDebugText(5,`UUID:${t}`),this.core.setDebugText(6,`targetsIds:${o}`)}))}move(e,t){this.status.virtualX=e,this.status.virtualY=t,this.status.isStay=!0,this.status.force_update=!0,this.moveConfirmed(e,t)}teleportation(e,t){this.status.teleportation(e,t)}moveConfirmed(){const{status:e}=this;e.moveConfirmed()}update(e){this.ui_DIsplayPoint.update(e)}weaponAttack({offense:e,defense:t}){this.scene.battleLogic.weaponAttack({offense:e,defense:t})}determineInitiative(e){return this.scene.battleLogic.determineInitiative(e)}play(e){this.scene.play(e,this)}beforeAttack(e,t){const{characterName:a,addText:s}=this,{characterName:i}=t,{itemName:r}=e;this.play("sword_slash_2"),s(`${a} \u306f ${i} \u306b ${r} \u3067\u653b\u6483\uff01`)}attackMissed(e){const{addText:t}=this,{itemName:a}=e;t(`${a} \u3092\u4f7f\u3063\u305f\u653b\u6483\u306f\u5916\u308c\u305f\uff01`)}blockAttack(e){const{addText:t}=this,{characterName:a}=e;t(`${a}\u304b\u3089\u306e\u653b\u6483\u3092\u9632\u5177\u3067\u9632\u3044\u3060\uff01`)}applyDamage({point:e,target:t,silent:a=!1}){const{addText:s}=this;a||s(t?`\u3044\u3063\u3066\uff01 ${t.characterName} \u306e\u653b\u6483\u3067 ${e} \u30dd\u30a4\u30f3\u30c8\u306e\u30c0\u30e1\u30fc\u30b8\u3092\u304f\u3089\u3063\u305f\uff01`:`\u3044\u3066\u3048\uff01 ${e} \u30dd\u30a4\u30f3\u30c8\u306e\u30c0\u30e1\u30fc\u30b8\u3092\u304f\u3089\u3063\u305f\uff01`),t&&this.addTarget(t.uuid),t&&this.status.currentBehavior===de&&(this.status.currentBehavior=me),this.addDisplayPoint({x:16,pointText:`${e}`});const i=this.status.hp-e;return this.status.hp=Math.max(i,0),i<1&&(this.play("strike_8"),this.died(t),!0)}addDisplayPoint=({x:e,y:t,pointText:a})=>this.ui_DIsplayPoint.addDisplayPoint({x:e,y:t,pointText:a});getTargetList(){return this.status.targetsIds.map((e=>this.scene.getEnemyById(e)))}setTargetList(e){this.status.targetsIds=e.map((e=>e.uuid))}hasTarget(){return this.status.targetsIds?.length}selectAttackTarget(){const{mapX:e,mapY:t,scene:a,currentBehavior:s}=this;if(!this.hasTarget()&&s===ue){const e=a.getEnemiesInRange(this,10);this.setTargetList(e)}const i=this.getTargetList();i.push(this.scene.getPlayer());return i.filter((s=>{if(s){const{mapX:i,mapY:r}=s;return a.isApproachActor({pMapX:e,pMapY:t,mMapX:i,mMapY:r})}return!1})).sort(((a,s)=>p({mapX:e,mapY:t},{mapX:a.mapX,mapY:a.mapY})-p({mapX:e,mapY:t},{mapX:s.mapX,mapY:s.mapY})))[0]}applyTargetsIds(e){this.status.targetsIds=this.status.targetsIds.filter((t=>!e.includes(t)))}applyExp(e){const{addText:t,characterName:a}=this,{expReward:s}=e;this.status.exp+=s,t(`${a} \u306f ${s} \u306e\u7d4c\u9a13\u5024\u3092\u5f97\u305f\uff01`),this.checkExp()}checkExp(){this.scene.battleLogic.levelup({offense:this})}died(){const{addText:e}=this;e("\u3057  \u3093  \u3060  \u3088")}addTarget(e){this.isPlayer||this.status.targetsIds.includes(e)||this.status.targetsIds.push(e),this.status.targetsIds.sort(((t,a)=>(a.key===e)-(t.key===e)))}escapeTrap(){console.log("escapeTrap")}trappedIn(){console.log("trappedIn")}getItem(e){const{addText:t}=this,a={...e};a.uuid=(0,le.Z)(),this.status.items.push(a),t(`${a.itemName}\u3092GET\u3057\u305f\uff01`)}learnSpell(e){const{addText:t}=this,a={...e};a.uuid=(0,le.Z)(),a.magicAttribute===Te&&this.status.magics.white.push(a),a.magicAttribute===Se&&this.status.magics.black.push(a),t(`\u30b9\u30da\u30eb ${a.magicName}\u3092\u5fb9\u591c\u3057\u3066\u899a\u3048\u305f\uff01`)}discoverDoor(){console.log("discoverDoor")}openDoor(){console.log("openDoor")}closeDoor(){console.log("closeDoor")}healHp(){console.log("healHp")}healMp(){console.log("healMp")}useMp(e){this.status.mp=Math.max(0,this.status.mp-e)}equipment(e,t){this.status.equipment(e,t)}itemUsed(e,t){this.status.items.splice(t,1),this.status.stay({force:!0})}magicUsed(){this.status.stay({force:!0})}equipmentItems(){return[]}removeEquipment(){console.log("removeEquipment")}discoverChest(){console.log("removeEquipment")}discoverEmptyChest(){console.log("discoverEmptyChest")}getItems(){console.log("getItems")}attack(){}diceRoll=({diceText:e,status:t})=>this.core.diceRoll({diceText:e,status:t});getUUID=e=>this.status.uuid;addText=(e,t)=>{const{scene:{addText:a}}=this;a(e,t)};goToPrevLevel(){console.log("goToPrevLevel")}goToNextLevel(){console.log("goToNextLevel")}getCharacterName=e=>this.status.characterName;getPrim=e=>this.mainContainer;get equipments(){return this.status.getEquipments()}get characterName(){return this.status.characterName}get uuid(){return this.status.uuid}get hp(){return this.status.hp}get mp(){return this.status.mp}get maxHp(){return this.status.maxHp}get maxMp(){return this.status.maxMp}get str(){return this.status.str}get dex(){return this.status.dex}get con(){return this.status.con}get intl(){return this.status.intl}get wiz(){return this.status.wiz}get cha(){return this.status.cha}get modifiers(){return this.status.modifiers}get expReward(){return this.status.expReward}get currentBehavior(){return this.status.currentBehavior}get mapX(){return this.status.mapX}get mapY(){return this.status.mapY}get isPlayer(){return this.status.isPlayer}get isStay(){return this.status.isStay}get isForceUpdate(){return this.status.force_update}get x(){return this.mainContainer.x}get y(){return this.mainContainer.y}get cx(){return this.mainContainer.x+16}get cy(){return this.mainContainer.y+16}};const _e=class extends Re{constructor({core:e,scene:t,name:a="human"}){super({core:e,scene:t,status:new we({hp:15,maxHp:15,mp:1e3,maxMp:1e3})});const{textures:{tx_main:i}}=e,{mainMap:r}=t;this.mainMap=r,this.mainMap.addResetCallback((e=>{this.respawn()})),this.healHp.bind(this);const n=new s.jyi(i[`${a}`]);n.interactive=!1,this.container.addChild(n),this.status.modifiers.str=this.diceRoll({diceText:"1d4+0"}),this.status.modifiers.dex=this.diceRoll({diceText:"1d4+0"}),this.status.modifiers.con=this.diceRoll({diceText:"1d4+0"}),this.status.modifiers.intl=this.diceRoll({diceText:"1d4+0"}),this.status.modifiers.wiz=this.diceRoll({diceText:"1d4+0"}),this.status.modifiers.cha=this.diceRoll({diceText:"1d4+0"}),this.status.mapX=0,this.status.mapY=0,this.getItem(H[1]),this.getItem(H[2]),this.getItem(H[3]),this.getItem(H[4]),this.getItem(H[5]),this.getItem(H[6]),this.getItem(H[16]),this.getItem(H[17]),this.getItem(H[18]),this.getItem(H[19]),this.getItem(H[20]),this.getItem(H[21]),this.getItem(H[22]),this.getItem(H[23]),this.getItem(H[24]),this.getItem(H[6]),this.getItem(H[2]),this.getItem(H[3]),this.getItem(H[4]),this.getItem(H[5]),this.getItem(H[6]),this.getItem(H[7]),this.getItem(H[8]),this.getItem(H[8]),this.learnSpell(Ce[0]),this.learnSpell(Ce[1]),this.learnSpell(Ce[2]);const{status:{trialMove:o}}=this;this.inputMap={w:e=>o("u"),s:e=>o("d"),a:e=>o("l"),d:e=>o("r"),".":e=>this.status.stay({}),ArrowUp:e=>o("u"),ArrowDown:e=>o("d"),ArrowLeft:e=>o("l"),ArrowRight:e=>o("r")}}setMap=e=>{this.mainMap=e,this.mainMap.addResetCallback((e=>{this.respawn()}))};getStatus=e=>this.status;respawn(){const{x:e,y:t}=this.mainMap.getRespawnPosition();this.status.hp=this.status.maxHp,this.move(e,t)}trappedIn({dmg:e,difficulty:t,name:a}){const{addText:s,status:i}=this,r=t<=this.diceRoll({diceText:"1d20+dex",status:i})?0:this.diceRoll({diceText:e});return!!r&&(s(`\u30a6\u30c3\u30d7\u30b9!!  ${a}\u3068\u3044\u3046\u3001\u7f60\u306b\u30cf\u30de\u3063\u305f\uff01`),this.applyDamage({point:r}),!0)}escapeTrap(){const{addText:e}=this;e("\u3057\u304b\u3057\u3001\u767a\u52d5\u524d\u306b\u30d2\u30e7\u30a4\u3063\u3068\u907f\u3051\u305f\uff01")}goToPrevLevel(e){const{addText:t}=this;t(`\u4e0a\u308a\u968e\u6bb5\u3058\u3083\u306a\u3044\u304b\uff01\u3044\u304f\u305e\uff01${e}`),this.scene.goto(e)}goToNextLevel(e){const{addText:t}=this;t(`\u4e0b\u308a\u968e\u6bb5\u3058\u3083\u306a\u3044\u304b\uff01\u3044\u304f\u305e\uff01${e}`),this.scene.goto(e)}died(){const{addText:e,characterName:t}=this;e(`${t}\u306f\u3001 \u3057  \u3093  \u3060  \uff01\uff01`),this.scene.windowClose(),this.respawn()}moveConfirmed(e,t){const{mainMap:a}=this;super.moveConfirmed(),a.center(e,t)}discoverChest(){const{addText:e}=this;e("\u5b9d\u7bb1\u3060\uff01")}discoverDoor(){const{addText:e}=this;e("\u3057\u307e\u3063\u305f\uff01 \u9589\u307e\u3063\u305f\u30c9\u30a2\u3060\uff01")}openDoor(){const{addText:e}=this;this.play("iron_door_open"),e("\u30c9\u30a2\u3092\u958b\u3051\u305f\uff01")}items=e=>this.status.items;magics=e=>[...this.status.magics.white,...this.status.magics.black];getEquipments=e=>this.status.equipments;isItemEquipped=e=>this.status.isItemEquipped(e);equipmentItems(){return this.items().filter((({itemType:e})=>P.includes(e)))}healHp(e,{itemName:t,magicName:a}){const{addText:s}=this,{characterName:i,hp:r,maxHp:n}=this.status,o=r;this.status.hp+=e,this.status.hp=Math.min(this.status.hp,n);s(`${i} \u306f\u3001${t||a} \u3092\u4f7f\u7528\u3057\u3066 ${this.status.hp-o} \u30dd\u30a4\u30f3\u30c8\u56de\u5fa9\u3057\u305f\u3002`),s(t?"\u3046\u307e\u3057\uff01\uff01":"\u30b7\u30e3\u30ad\u30fc\u30f3\uff01")}checkCollision=e=>{const{mainMap:t,status:a}=this,{virtualX:s,virtualY:i}=a,r=t.getTile(s,i),n=this.uuid,o=this.scene.getEnemys().filter((({uuid:e,status:{mapX:t,mapY:a}})=>e!=n&&t===s&&a===i));return o.forEach((e=>{const[t,a]=this.determineInitiative([this,e]);t.isStay||this.weaponAttack({offense:t,defense:a}),a.isStay||this.weaponAttack({offense:a,defense:t})})),r.hit({actor:this,status:a})||o.length};update=e=>{super.update(e);const{core:{input:t},scene:{handleStepUpdate:a,isWindowOpen:s},mainMap:i,inputMap:r,status:n,status:{beforeUpdate:o,afterUpdate:h,isMove:c},mainContainer:p}=this;if(s&&!this.isForceUpdate)return;o();const l=Object.keys(r).find((e=>t.isSingleDown(e)));if(l&&r[l](),p.x=i.mapContainer.x+n.mapX*v,p.y=i.mapContainer.y+n.mapY*v,!c())return;const{virtualX:d,virtualY:m}=n;a(d,m),this.checkCollision()||this.moveConfirmed(d,m),n.steps++,h()}},Be=[{lv:10,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"angel",characterName:"\u30a8\u30f3\u30b8\u30a7\u30eb",speed:1.2,maxHp:200,maxMp:150,expReward:500,expGold:400,gender:oe.value,race:pe.celestial},{lv:4,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"azure_jelly",characterName:"\u30a2\u30ba\u30fc\u30eb\u30bc\u30ea\u30fc",speed:.5,maxHp:50,maxMp:0,expReward:120,expGold:80,gender:ce.value,race:pe.amorphous},{lv:7,spawnStartLv:3,spawnEndLv:7,currentBehavior:me,skin:"big_kobold",characterName:"\u30d3\u30c3\u30b0\u30b3\u30dc\u30eb\u30c9",speed:.7,maxHp:120,maxMp:30,expReward:250,expGold:200,gender:oe.value,race:pe.humanoid},{lv:3,spawnStartLv:0,spawnEndLv:4,currentBehavior:me,skin:"boggart",characterName:"\u30dc\u30ac\u30fc\u30c8",speed:.6,maxHp:40,maxMp:50,expReward:100,expGold:70,gender:ce.value,race:pe.fey},{lv:2,spawnStartLv:0,spawnEndLv:3,currentBehavior:ue,skin:"brown_ooze",characterName:"\u30d6\u30e9\u30a6\u30f3\u30a6\u30fc\u30ba",speed:.3,maxHp:30,maxMp:0,expReward:60,expGold:40,gender:ce.value,race:pe.amorphous},{lv:8,spawnStartLv:4,spawnEndLv:8,currentBehavior:me,skin:"centaur",characterName:"\u30b1\u30f3\u30bf\u30a6\u30ed\u30b9",speed:1,maxHp:150,maxMp:40,expReward:300,expGold:250,gender:oe.value,race:pe.beast},{lv:9,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"centaur_warrior",characterName:"\u30b1\u30f3\u30bf\u30a6\u30ed\u30b9\u30a6\u30a9\u30ea\u30a2\u30fc",speed:1.1,maxHp:180,maxMp:50,expReward:350,expGold:300,gender:oe.value,race:pe.beast},{lv:9,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"centaur_warrior-melee",characterName:"\u30b1\u30f3\u30bf\u30a6\u30ed\u30b9\u30a6\u30a9\u30ea\u30a2\u30fc(\u8fd1\u63a5\u6226\u95d8)",speed:1.1,maxHp:180,maxMp:50,expReward:350,expGold:300,gender:oe.value,race:pe.beast},{lv:8,spawnStartLv:4,spawnEndLv:8,currentBehavior:me,skin:"centaur-melee",characterName:"\u30b1\u30f3\u30bf\u30a6\u30ed\u30b9(\u8fd1\u63a5\u6226\u95d8)",speed:1,maxHp:150,maxMp:40,expReward:300,expGold:250,gender:oe.value,race:pe.beast},{lv:11,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"cyclops",characterName:"\u30b5\u30a4\u30af\u30ed\u30d7\u30b9",speed:.8,maxHp:250,maxMp:60,expReward:600,expGold:500,gender:oe.value,race:pe.giant},{lv:12,spawnStartLv:8,spawnEndLv:9,currentBehavior:me,skin:"daeva",characterName:"\u30c0\u30a8\u30fc\u30f4\u30a1",speed:1.3,maxHp:270,maxMp:200,expReward:650,expGold:550,gender:oe.value,race:pe.celestial},{lv:15,spawnStartLv:9,spawnEndLv:9,currentBehavior:me,skin:"death_drake",characterName:"\u30c7\u30b9\u30c9\u30ec\u30a4\u30af",speed:1,maxHp:350,maxMp:150,expReward:800,expGold:700,gender:ce.value,race:pe.dragon},{lv:13,spawnStartLv:8,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_annihilator",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30a2\u30ca\u30a4\u30a2\u30ec\u30fc\u30bf\u30fc",speed:.9,maxHp:280,maxMp:220,expReward:700,expGold:600,gender:oe.value,race:pe.elf},{lv:14,spawnStartLv:9,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_blademaster",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30d6\u30ec\u30fc\u30c9\u30de\u30b9\u30bf\u30fc",speed:1.2,maxHp:320,maxMp:180,expReward:750,expGold:650,gender:oe.value,race:pe.elf},{lv:12,spawnStartLv:8,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_conjurer",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30b3\u30f3\u30b8\u30e3\u30e9\u30fc",speed:.8,maxHp:260,maxMp:240,expReward:650,expGold:550,gender:oe.value,race:pe.elf},{lv:14,spawnStartLv:9,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_death_mage",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30c7\u30b9\u30e1\u30a4\u30b8",speed:.8,maxHp:310,maxMp:250,expReward:750,expGold:650,gender:oe.value,race:pe.elf},{lv:13,spawnStartLv:8,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_demonologist",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30c7\u30e2\u30ce\u30ed\u30b8\u30b9\u30c8",speed:.9,maxHp:290,maxMp:230,expReward:700,expGold:600,gender:oe.value,race:pe.elf},{lv:11,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_fighter",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30d5\u30a1\u30a4\u30bf\u30fc",speed:1,maxHp:250,maxMp:100,expReward:600,expGold:500,gender:oe.value,race:pe.elf},{lv:15,spawnStartLv:9,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_high_priest",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30cf\u30a4\u30d7\u30ea\u30fc\u30b9\u30c8",speed:.7,maxHp:350,maxMp:300,expReward:800,expGold:700,gender:oe.value,race:pe.elf},{lv:14,spawnStartLv:9,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_knight",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30ca\u30a4\u30c8",speed:1.1,maxHp:320,maxMp:180,expReward:750,expGold:650,gender:oe.value,race:pe.elf},{lv:7,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_mage",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30e1\u30a4\u30b8",speed:.7,maxHp:60,maxMp:80,expReward:700,expGold:500,gender:oe.value,race:pe.elf},{lv:8,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_master_archer",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30de\u30b9\u30bf\u30fc\u30a2\u30fc\u30c1\u30e3\u30fc",speed:.8,maxHp:70,maxMp:50,expReward:800,expGold:600,gender:oe.value,race:pe.elf},{lv:6,spawnStartLv:4,spawnEndLv:8,currentBehavior:me,skin:"deep_elf_priest",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30d7\u30ea\u30fc\u30b9\u30c8",speed:.6,maxHp:55,maxMp:90,expReward:600,expGold:450,gender:oe.value,race:pe.elf},{lv:5,spawnStartLv:3,spawnEndLv:7,currentBehavior:me,skin:"deep_elf_soldier",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30bd\u30eb\u30b8\u30e3\u30fc",speed:.5,maxHp:50,maxMp:30,expReward:500,expGold:400,gender:oe.value,race:pe.elf},{lv:9,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_sorcerer",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30bd\u30fc\u30b5\u30e9\u30fc",speed:.9,maxHp:75,maxMp:100,expReward:900,expGold:700,gender:oe.value,race:pe.elf},{lv:7,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"deep_elf_summoner",characterName:"\u30c7\u30a3\u30fc\u30d7\u30a8\u30eb\u30d5\u30b5\u30e2\u30ca\u30fc",speed:.7,maxHp:60,maxMp:80,expReward:700,expGold:500,gender:oe.value,race:pe.elf},{lv:6,spawnStartLv:4,spawnEndLv:8,currentBehavior:me,skin:"deep_troll",characterName:"\u30c7\u30a3\u30fc\u30d7\u30c8\u30ed\u30fc\u30eb",speed:.6,maxHp:100,maxMp:20,expReward:600,expGold:450,gender:oe.value,race:pe.troll},{lv:3,spawnStartLv:1,spawnEndLv:5,currentBehavior:me,skin:"deformed_elf",characterName:"\u30c7\u30d5\u30a9\u30fc\u30e0\u30c9\u30a8\u30eb\u30d5",speed:.3,maxHp:30,maxMp:40,expReward:300,expGold:200,gender:oe.value,race:pe.elf},{lv:3,spawnStartLv:1,spawnEndLv:5,currentBehavior:me,skin:"deformed_human",characterName:"\u30c7\u30d5\u30a9\u30fc\u30e0\u30c9\u30d2\u30e5\u30fc\u30de\u30f3",speed:.3,maxHp:30,maxMp:40,expReward:300,expGold:200,gender:oe.value,race:pe.human},{lv:3,spawnStartLv:1,spawnEndLv:5,currentBehavior:me,skin:"deformed_orc",characterName:"\u30c7\u30d5\u30a9\u30fc\u30e0\u30c9\u30aa\u30fc\u30af",speed:.3,maxHp:30,maxMp:40,expReward:300,expGold:200,gender:oe.value,race:pe.orc},{lv:7,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"demonspawn",characterName:"\u30c7\u30e2\u30f3\u30b9\u30dd\u30fc\u30f3",speed:.7,maxHp:70,maxMp:60,expReward:700,expGold:500,gender:oe.value,race:pe.demon},{lv:9,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"dragon",characterName:"\u30c9\u30e9\u30b4\u30f3",speed:.9,maxHp:150,maxMp:50,expReward:900,expGold:700,gender:oe.value,race:pe.dragon},{lv:4,spawnStartLv:2,spawnEndLv:6,currentBehavior:me,skin:"dwarf",characterName:"\u30c9\u30ef\u30fc\u30d5",speed:.4,maxHp:40,maxMp:30,expReward:400,expGold:300,gender:oe.value,race:pe.dwarf},{lv:4,spawnStartLv:2,spawnEndLv:6,currentBehavior:me,skin:"elf",characterName:"\u30a8\u30eb\u30d5",speed:.4,maxHp:40,maxMp:50,expReward:400,expGold:300,gender:oe.value,race:pe.elf},{lv:8,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"ettin",characterName:"\u30a8\u30c3\u30c6\u30a3\u30f3",speed:.8,maxHp:120,maxMp:40,expReward:800,expGold:600,gender:oe.value,race:pe.giant},{lv:5,spawnStartLv:3,spawnEndLv:7,currentBehavior:me,skin:"eye_of_devastation",characterName:"\u30a2\u30a4\u30aa\u30d6\u30c7\u30d0\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3",speed:.5,maxHp:50,maxMp:70,expReward:500,expGold:400,gender:oe.value,race:pe.eye},{lv:4,spawnStartLv:2,spawnEndLv:6,currentBehavior:me,skin:"eye_of_draining",characterName:"\u30a2\u30a4\u30aa\u30d6\u30c9\u30ec\u30a4\u30cb\u30f3\u30b0",speed:.4,maxHp:40,maxMp:60,expReward:400,expGold:300,gender:oe.value,race:pe.eye},{lv:6,spawnStartLv:4,spawnEndLv:8,currentBehavior:me,skin:"fire_drake",characterName:"\u30d5\u30a1\u30a4\u30a2\u30c9\u30ec\u30a4\u30af",speed:.6,maxHp:80,maxMp:40,expReward:600,expGold:450,gender:oe.value,race:pe.dragon},{lv:7,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"fire_giant",characterName:"\u30d5\u30a1\u30a4\u30a2\u30b8\u30e3\u30a4\u30a2\u30f3\u30c8",speed:.7,maxHp:100,maxMp:30,expReward:700,expGold:500,gender:oe.value,race:pe.giant},{lv:7,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"frost_giant",characterName:"\u30d5\u30ed\u30b9\u30c8\u30b8\u30e3\u30a4\u30a2\u30f3\u30c8",speed:.7,maxHp:100,maxMp:30,expReward:700,expGold:500,gender:oe.value,race:pe.giant},{lv:2,spawnStartLv:1,spawnEndLv:4,currentBehavior:me,skin:"giant_amoeba",characterName:"\u30b8\u30e3\u30a4\u30a2\u30f3\u30c8\u30a2\u30e1\u30fc\u30d0",speed:.2,maxHp:20,maxMp:10,expReward:200,expGold:100,gender:oe.value,race:pe.ooze},{lv:3,spawnStartLv:1,spawnEndLv:5,currentBehavior:me,skin:"giant_eyeball",characterName:"\u30b8\u30e3\u30a4\u30a2\u30f3\u30c8\u30a2\u30a4\u30dc\u30fc\u30eb",speed:.3,maxHp:30,maxMp:20,expReward:300,expGold:200,gender:oe.value,race:pe.eye},{lv:6,spawnStartLv:5,spawnEndLv:9,currentBehavior:me,skin:"orange_brain",characterName:"\u30b8\u30e3\u30a4\u30a2\u30f3\u30c8\u30aa\u30ec\u30f3\u30b8\u30d6\u30ec\u30a4\u30f3",speed:.2,maxHp:80,maxMp:150,expReward:600,expGold:600,gender:oe.value,race:pe.human},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"shapeshifter",characterName:"\u30b0\u30ed\u30fc\u30a4\u30f3\u30b0\u30b7\u30a7\u30a4\u30d7\u30b7\u30d5\u30bf\u30fc",speed:.9,maxHp:100,maxMp:120,expReward:700,expGold:700,gender:oe.value,race:pe.human},{lv:2,spawnStartLv:1,spawnEndLv:3,currentBehavior:me,skin:"gnoll",characterName:"\u30b0\u30ce\u30fc\u30eb",speed:.5,maxHp:25,maxMp:30,expReward:200,expGold:200,gender:oe.value,race:pe.human},{lv:1,spawnStartLv:1,spawnEndLv:2,currentBehavior:me,skin:"goblin",characterName:"\u30b4\u30d6\u30ea\u30f3",speed:.3,maxHp:15,maxMp:20,expReward:100,expGold:100,gender:oe.value,race:pe.human},{lv:9,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"golden_dragon",characterName:"\u30b4\u30fc\u30eb\u30c7\u30f3\u30c9\u30e9\u30b4\u30f3",speed:1,maxHp:200,maxMp:200,expReward:900,expGold:900,gender:oe.value,race:pe.dragon},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"golden_eye",characterName:"\u30b4\u30fc\u30eb\u30c7\u30f3\u30a2\u30a4",speed:.6,maxHp:50,maxMp:70,expReward:400,expGold:400,gender:oe.value,race:pe.human},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"orb_of_eyes",characterName:"\u30b0\u30ec\u30fc\u30c8\u30aa\u30fc\u30d6\u30aa\u30d6\u30a2\u30a4\u30ba",speed:.4,maxHp:80,maxMp:140,expReward:600,expGold:600,gender:oe.value,race:pe.human},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"greater_naga",characterName:"\u30b0\u30ec\u30fc\u30bf\u30fc\u30ca\u30fc\u30ac",speed:.8,maxHp:110,maxMp:130,expReward:700,expGold:700,gender:oe.value,race:pe.naga},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"griffon",characterName:"\u30b0\u30ea\u30d5\u30a9\u30f3",speed:.9,maxHp:70,maxMp:80,expReward:500,expGold:500,gender:oe.value,race:pe.animal},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"guardian_serpent",characterName:"\u30ac\u30fc\u30c7\u30a3\u30a2\u30f3\u30b5\u30fc\u30da\u30f3\u30c8",speed:.7,maxHp:85,maxMp:110,expReward:600,expGold:600,gender:oe.value,race:pe.serpent},{lv:3,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"halfling",characterName:"\u30cf\u30fc\u30d5\u30ea\u30f3\u30b0",speed:.6,maxHp:35,maxMp:40,expReward:300,expGold:300,gender:oe.value,race:pe.human},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"harpy",characterName:"\u30cf\u30fc\u30d4\u30fc",speed:.8,maxHp:70,maxMp:80,expReward:500,expGold:500,gender:he.value,race:pe.human},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"hell_knight",characterName:"\u30d8\u30eb\u30ca\u30a4\u30c8",speed:.7,maxHp:110,maxMp:120,expReward:700,expGold:700,gender:oe.value,race:pe.human},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"hill_giant",characterName:"\u30d2\u30eb\u30b8\u30e3\u30a4\u30a2\u30f3\u30c8",speed:.4,maxHp:90,maxMp:95,expReward:600,expGold:600,gender:oe.value,race:pe.giant},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"hippogriff",characterName:"\u30d2\u30dd\u30b0\u30ea\u30d5",speed:.9,maxHp:50,maxMp:60,expReward:400,expGold:400,gender:oe.value,race:pe.animal},{lv:2,spawnStartLv:1,spawnEndLv:4,currentBehavior:me,skin:"hobgoblin",characterName:"\u30db\u30d6\u30b4\u30d6\u30ea\u30f3",speed:.4,maxHp:25,maxMp:30,expReward:200,expGold:200,gender:oe.value,race:pe.human},{lv:3,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"human",characterName:"\u30d2\u30e5\u30fc\u30de\u30f3",speed:.6,maxHp:40,maxMp:50,expReward:300,expGold:300,gender:oe.value,race:pe.human},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"human_monk_ghost",characterName:"\u30d2\u30e5\u30fc\u30de\u30f3\u30e2\u30f3\u30af\u30b4\u30fc\u30b9\u30c8",speed:.7,maxHp:55,maxMp:70,expReward:400,expGold:400,gender:oe.value,race:pe.ghost},{lv:2,spawnStartLv:1,spawnEndLv:3,currentBehavior:me,skin:"human_slave",characterName:"\u30d2\u30e5\u30fc\u30de\u30f3\u30b9\u30ec\u30a4\u30d6",speed:.5,maxHp:30,maxMp:35,expReward:200,expGold:200,gender:oe.value,race:pe.human},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"hydra1",characterName:"\u30d2\u30c9\u30e91",speed:.6,maxHp:75,maxMp:80,expReward:500,expGold:500,gender:oe.value,race:pe.dragon},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"hydra2",characterName:"\u30d2\u30c9\u30e92",speed:.6,maxHp:90,maxMp:95,expReward:600,expGold:600,gender:oe.value,race:pe.dragon},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"hydra3",characterName:"\u30d2\u30c9\u30e93",speed:.6,maxHp:105,maxMp:110,expReward:700,expGold:700,gender:oe.value,race:pe.dragon},{lv:8,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"hydra4",characterName:"\u30d2\u30c9\u30e94",speed:.6,maxHp:120,maxMp:125,expReward:800,expGold:800,gender:oe.value,race:pe.dragon},{lv:9,spawnStartLv:8,spawnEndLv:9,currentBehavior:me,skin:"hydra5",characterName:"\u30d2\u30c9\u30e95",speed:.6,maxHp:135,maxMp:140,expReward:900,expGold:900,gender:oe.value,race:pe.dragon},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"ice_beast",characterName:"\u30a2\u30a4\u30b9\u30d3\u30fc\u30b9\u30c8",speed:.5,maxHp:55,maxMp:60,expReward:400,expGold:400,gender:oe.value,race:pe.beast},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"ice_dragon",characterName:"\u30a2\u30a4\u30b9\u30c9\u30e9\u30b4\u30f3",speed:.7,maxHp:90,maxMp:95,expReward:600,expGold:600,gender:oe.value,race:pe.dragon},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"iron_dragon",characterName:"\u30a2\u30a4\u30a2\u30f3\u30c9\u30e9\u30b4\u30f3",speed:.4,maxHp:110,maxMp:115,expReward:700,expGold:700,gender:oe.value,race:pe.dragon},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"iron_troll",characterName:"\u30a2\u30a4\u30a2\u30f3\u30c8\u30ed\u30fc\u30eb",speed:.5,maxHp:75,maxMp:80,expReward:500,expGold:500,gender:oe.value,race:pe.troll},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"monk_ghost",characterName:"\u30a2\u30a4\u30a2\u30f3\u30c8\u30ed\u30fc\u30eb\u30e2\u30f3\u30af\u30b4\u30fc\u30b9\u30c8",speed:.6,maxHp:90,maxMp:95,expReward:600,expGold:600,gender:oe.value,race:pe.ghost},{lv:3,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"jelly",characterName:"\u30b8\u30a7\u30ea\u30fc",speed:.3,maxHp:40,maxMp:45,expReward:300,expGold:300,gender:oe.value,race:pe.ooze},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"killer_klown",characterName:"\u30ad\u30e9\u30fc\u30af\u30e9\u30a6\u30f3",speed:.9,maxHp:110,maxMp:120,expReward:700,expGold:700,gender:oe.value,race:pe.human},{lv:2,spawnStartLv:1,spawnEndLv:4,currentBehavior:me,skin:"kobold",characterName:"\u30b3\u30dc\u30eb\u30c9",speed:.5,maxHp:20,maxMp:30,expReward:200,expGold:200,gender:oe.value,race:pe.human},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"kobold_demonologist",characterName:"\u30b3\u30dc\u30eb\u30c9\u30c7\u30e2\u30ce\u30ed\u30b8\u30b9\u30c8",speed:.6,maxHp:55,maxMp:70,expReward:400,expGold:400,gender:oe.value,race:pe.human},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"lindwurm",characterName:"\u30ea\u30f3\u30c9\u30f4\u30eb\u30e0",speed:.7,maxHp:80,maxMp:85,expReward:500,expGold:500,gender:oe.value,race:pe.dragon},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"manticore",characterName:"\u30de\u30f3\u30c6\u30a3\u30b3\u30a2",speed:.8,maxHp:95,maxMp:100,expReward:600,expGold:600,gender:oe.value,race:pe.beast},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"merfolk_aquamancer",characterName:"\u30a2\u30af\u30a2\u30de\u30f3\u30b5\u30fc",speed:.7,maxHp:75,maxMp:90,expReward:500,expGold:500,gender:oe.value,race:pe.merfolk},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"merfolk_aquamancer_water",characterName:"\u30a2\u30af\u30a2\u30de\u30f3\u30b5\u30fc\u30a6\u30a9\u30fc\u30bf\u30fc",speed:.8,maxHp:75,maxMp:100,expReward:500,expGold:500,gender:oe.value,race:pe.merfolk},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"merfolk_fighter",characterName:"\u30d5\u30a1\u30a4\u30bf\u30fc",speed:.6,maxHp:60,maxMp:65,expReward:400,expGold:400,gender:oe.value,race:pe.merfolk},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"merfolk_fighter_water",characterName:"\u30d5\u30a1\u30a4\u30bf\u30fc\u30a6\u30a9\u30fc\u30bf\u30fc",speed:.7,maxHp:60,maxMp:70,expReward:400,expGold:400,gender:oe.value,race:pe.merfolk},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"merfolk_impaler",characterName:"\u30a4\u30f3\u30da\u30a4\u30e9\u30fc",speed:.8,maxHp:95,maxMp:100,expReward:600,expGold:600,gender:oe.value,race:pe.merfolk},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"merfolk_impaler_water",characterName:"\u30a4\u30f3\u30da\u30a4\u30e9\u30fc\u30a6\u30a9\u30fc\u30bf\u30fc",speed:.9,maxHp:95,maxMp:110,expReward:600,expGold:600,gender:oe.value,race:pe.merfolk},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"merfolk_javelineer",characterName:"\u30b8\u30e3\u30d9\u30ea\u30cb\u30a2",speed:.7,maxHp:75,maxMp:80,expReward:500,expGold:500,gender:oe.value,race:pe.merfolk},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"merfolk_javelineer_water",characterName:"\u30b8\u30e3\u30d9\u30ea\u30cb\u30a2\u30a6\u30a9\u30fc\u30bf\u30fc",speed:.8,maxHp:75,maxMp:90,expReward:500,expGold:500,gender:oe.value,race:pe.merfolk},{lv:3,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"merfolk_plain",characterName:"\u30d7\u30ec\u30a4\u30f3",speed:.6,maxHp:40,maxMp:50,expReward:300,expGold:300,gender:oe.value,race:pe.merfolk},{lv:3,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"merfolk_plain_water",characterName:"\u30d7\u30ec\u30a4\u30f3\u30a6\u30a9\u30fc\u30bf\u30fc",speed:.7,maxHp:40,maxMp:55,expReward:300,expGold:300,gender:oe.value,race:pe.merfolk},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"mermaid",characterName:"\u30de\u30fc\u30e1\u30a4\u30c9",speed:.8,maxHp:90,maxMp:100,expReward:600,expGold:600,gender:he.value,race:pe.merfolk},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"mermaid_water",characterName:"\u30de\u30fc\u30e1\u30a4\u30c9\u30a6\u30a9\u30fc\u30bf\u30fc",speed:.9,maxHp:90,maxMp:110,expReward:600,expGold:600,gender:he.value,race:pe.merfolk},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"minotaur",characterName:"\u30df\u30ce\u30bf\u30a6\u30ed\u30b9",speed:.7,maxHp:120,maxMp:100,expReward:700,expGold:700,gender:oe.value,race:pe.minotaur},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"mottled_dragon",characterName:"\u30e2\u30c3\u30c8\u30eb\u30c9\u30c9\u30e9\u30b4\u30f3",speed:.6,maxHp:75,maxMp:80,expReward:500,expGold:500,gender:oe.value,race:pe.dragon},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"naga",characterName:"\u30ca\u30fc\u30ac",speed:.5,maxHp:60,maxMp:70,expReward:400,expGold:400,gender:oe.value,race:pe.naga},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"naga_mage",characterName:"\u30ca\u30fc\u30ac\u30e1\u30a4\u30b8",speed:.6,maxHp:80,maxMp:90,expReward:500,expGold:500,gender:oe.value,race:pe.naga},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"naga_warrior",characterName:"\u30ca\u30fc\u30ac\u30a6\u30a9\u30ea\u30a2\u30fc",speed:.7,maxHp:100,maxMp:110,expReward:600,expGold:600,gender:oe.value,race:pe.naga},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"necromancer",characterName:"\u30cd\u30af\u30ed\u30de\u30f3\u30b5\u30fc",speed:.6,maxHp:110,maxMp:120,expReward:700,expGold:700,gender:oe.value,race:pe.human},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"ogre",characterName:"\u30aa\u30fc\u30ac",speed:.5,maxHp:80,maxMp:85,expReward:500,expGold:500,gender:oe.value,race:pe.ogre},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"ogre_mage",characterName:"\u30aa\u30fc\u30ac\u30e1\u30a4\u30b8",speed:.6,maxHp:95,maxMp:100,expReward:600,expGold:600,gender:oe.value,race:pe.ogre},{lv:3,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"ooze",characterName:"\u30a6\u30fc\u30ba",speed:.3,maxHp:40,maxMp:45,expReward:300,expGold:300,gender:oe.value,race:pe.ooze},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"orb_guardian",characterName:"\u30aa\u30fc\u30d6\u30ac\u30fc\u30c7\u30a3\u30a2\u30f3",speed:.7,maxHp:120,maxMp:130,expReward:700,expGold:700,gender:oe.value,race:pe.human},{lv:3,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"orc",characterName:"\u30aa\u30fc\u30af",speed:.5,maxHp:40,maxMp:45,expReward:300,expGold:300,gender:oe.value,race:pe.orc},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"orc_high_priest",characterName:"\u30aa\u30fc\u30af\u30cf\u30a4\u30d7\u30ea\u30fc\u30b9\u30c8",speed:.6,maxHp:95,maxMp:110,expReward:600,expGold:600,gender:oe.value,race:pe.orc},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"orc_knight",characterName:"\u30aa\u30fc\u30af\u30ca\u30a4\u30c8",speed:.7,maxHp:80,maxMp:85,expReward:500,expGold:500,gender:oe.value,race:pe.orc},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"orc_priest",characterName:"\u30aa\u30fc\u30af\u30d7\u30ea\u30fc\u30b9\u30c8",speed:.5,maxHp:60,maxMp:70,expReward:400,expGold:400,gender:oe.value,race:pe.orc},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"orc_sorcerer",characterName:"\u30aa\u30fc\u30af\u30bd\u30fc\u30b5\u30e9\u30fc",speed:.6,maxHp:90,maxMp:100,expReward:600,expGold:600,gender:oe.value,race:pe.orc},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"orc_warlord",characterName:"\u30aa\u30fc\u30af\u30a6\u30a9\u30fc\u30ed\u30fc\u30c9",speed:.8,maxHp:120,maxMp:125,expReward:700,expGold:700,gender:oe.value,race:pe.orc},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"orc_warrior",characterName:"\u30aa\u30fc\u30af\u30a6\u30a9\u30ea\u30a2\u30fc",speed:.7,maxHp:65,maxMp:70,expReward:400,expGold:400,gender:oe.value,race:pe.orc},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"orc_wizard",characterName:"\u30aa\u30fc\u30af\u30a6\u30a3\u30b6\u30fc\u30c9",speed:.6,maxHp:75,maxMp:80,expReward:500,expGold:500,gender:oe.value,race:pe.orc},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"pulsating_lump",characterName:"\u30d1\u30eb\u30bb\u30a4\u30c6\u30a3\u30f3\u30b0\u30e9\u30f3\u30d7",speed:.2,maxHp:55,maxMp:60,expReward:400,expGold:400,gender:oe.value,race:pe.ooze},{lv:8,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"quicksilver_dragon",characterName:"\u30af\u30a4\u30c3\u30af\u30b7\u30eb\u30d0\u30fc\u30c9\u30e9\u30b4\u30f3",speed:.9,maxHp:160,maxMp:170,expReward:800,expGold:800,gender:oe.value,race:pe.dragon},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"rock_troll",characterName:"\u30ed\u30c3\u30af\u30c8\u30ed\u30fc\u30eb",speed:.4,maxHp:100,maxMp:105,expReward:600,expGold:600,gender:oe.value,race:pe.troll},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"monk_ghost",characterName:"\u30ed\u30c3\u30af\u30c8\u30ed\u30fc\u30eb\u30e2\u30f3\u30af\u30b4\u30fc\u30b9\u30c8",speed:.5,maxHp:115,maxMp:120,expReward:700,expGold:700,gender:oe.value,race:pe.ghost},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"shadow_dragon",characterName:"\u30b7\u30e3\u30c9\u30a6\u30c9\u30e9\u30b4\u30f3",speed:.8,maxHp:120,maxMp:130,expReward:700,expGold:700,gender:oe.value,race:pe.dragon},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"shapeshifter",characterName:"\u30b7\u30a7\u30a4\u30d7\u30b7\u30d5\u30bf\u30fc",speed:.7,maxHp:95,maxMp:100,expReward:600,expGold:600,gender:oe.value,race:pe.human},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"shining_eye",characterName:"\u30b7\u30e3\u30a4\u30cb\u30f3\u30b0\u30a2\u30a4",speed:.3,maxHp:80,maxMp:85,expReward:500,expGold:500,gender:oe.value,race:pe.human},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"siren",characterName:"\u30b5\u30a4\u30ec\u30f3",speed:.6,maxHp:90,maxMp:95,expReward:600,expGold:600,gender:he.value,race:pe.human},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"siren_water",characterName:"\u30b5\u30a4\u30ec\u30f3\u30a6\u30a9\u30fc\u30bf\u30fc",speed:.7,maxHp:90,maxMp:105,expReward:600,expGold:600,gender:he.value,race:pe.human},{lv:8,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"sphinx",characterName:"\u30b9\u30d5\u30a3\u30f3\u30af\u30b9",speed:.8,maxHp:160,maxMp:150,expReward:800,expGold:800,gender:oe.value,race:pe.human},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"steam_dragon",characterName:"\u30b9\u30c1\u30fc\u30e0\u30c9\u30e9\u30b4\u30f3",speed:.6,maxHp:60,maxMp:65,expReward:400,expGold:400,gender:oe.value,race:pe.dragon},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"stone_giant",characterName:"\u30b9\u30c8\u30fc\u30f3\u30b8\u30e3\u30a4\u30a2\u30f3\u30c8",speed:.5,maxHp:100,maxMp:105,expReward:600,expGold:600,gender:oe.value,race:pe.giant},{lv:8,spawnStartLv:7,spawnEndLv:9,currentBehavior:me,skin:"storm_dragon",characterName:"\u30b9\u30c8\u30fc\u30e0\u30c9\u30e9\u30b4\u30f3",speed:.8,maxHp:150,maxMp:155,expReward:800,expGold:800,gender:oe.value,race:pe.dragon},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"swamp_dragon",characterName:"\u30b9\u30ef\u30f3\u30d7\u30c9\u30e9\u30b4\u30f3",speed:.6,maxHp:75,maxMp:80,expReward:500,expGold:500,gender:oe.value,race:pe.dragon},{lv:3,spawnStartLv:2,spawnEndLv:5,currentBehavior:me,skin:"swamp_drake",characterName:"\u30b9\u30ef\u30f3\u30d7\u30c9\u30ec\u30a4\u30af",speed:.5,maxHp:45,maxMp:50,expReward:300,expGold:300,gender:oe.value,race:pe.dragon},{lv:9,spawnStartLv:8,spawnEndLv:9,currentBehavior:me,skin:"titan",characterName:"\u30bf\u30a4\u30bf\u30f3",speed:.7,maxHp:180,maxMp:185,expReward:900,expGold:900,gender:oe.value,race:pe.giant},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"troll",characterName:"\u30c8\u30ed\u30fc\u30eb",speed:.5,maxHp:65,maxMp:70,expReward:400,expGold:400,gender:oe.value,race:pe.troll},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"two_headed_ogre",characterName:"\u30c4\u30fc\u30d8\u30c3\u30c7\u30c9\u30aa\u30fc\u30ac",speed:.6,maxHp:95,maxMp:100,expReward:600,expGold:600,gender:oe.value,race:pe.ogre},{lv:7,spawnStartLv:6,spawnEndLv:9,currentBehavior:me,skin:"vault_guard",characterName:"\u30f4\u30a9\u30eb\u30c8\u30ac\u30fc\u30c9",speed:.7,maxHp:120,maxMp:125,expReward:700,expGold:700,gender:oe.value,race:pe.human},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"wizard",characterName:"\u30a6\u30a3\u30b6\u30fc\u30c9",speed:.6,maxHp:80,maxMp:85,expReward:500,expGold:500,gender:oe.value,race:pe.human},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"wyvern",characterName:"\u30ef\u30a4\u30d0\u30fc\u30f3",speed:.7,maxHp:70,maxMp:75,expReward:400,expGold:400,gender:oe.value,race:pe.dragon},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"yaktaur",characterName:"\u30e4\u30af\u30c8\u30fc\u30eb",speed:.6,maxHp:85,maxMp:90,expReward:500,expGold:500,gender:oe.value,race:pe.human},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"yaktaur_captain",characterName:"\u30e4\u30af\u30c8\u30fc\u30eb\u30ad\u30e3\u30d7\u30c6\u30f3",speed:.7,maxHp:100,maxMp:105,expReward:600,expGold:600,gender:oe.value,race:pe.human},{lv:6,spawnStartLv:5,spawnEndLv:8,currentBehavior:me,skin:"yaktaur_captain_melee",characterName:"\u30e4\u30af\u30c8\u30fc\u30eb\u30ad\u30e3\u30d7\u30c6\u30f3\u30e1\u30ec\u30fc",speed:.8,maxHp:100,maxMp:110,expReward:600,expGold:600,gender:oe.value,race:pe.human},{lv:5,spawnStartLv:4,spawnEndLv:7,currentBehavior:me,skin:"yaktaur_melee",characterName:"\u30e4\u30af\u30c8\u30fc\u30eb\u30e1\u30ec\u30fc",speed:.7,maxHp:85,maxMp:95,expReward:500,expGold:500,gender:oe.value,race:pe.human},{lv:4,spawnStartLv:3,spawnEndLv:6,currentBehavior:me,skin:"acid_blob",characterName:"\u30a2\u30b7\u30c3\u30c9\u30d6\u30ed\u30d6",speed:.3,maxHp:60,maxMp:65,expReward:400,expGold:400,gender:oe.value,race:pe.ooze}];const Pe=class extends ge{constructor(e){super({lv:1,characterName:"",hp:10,mp:10,speed:.3,maxHp:10,maxMp:10,expReward:100,gender:oe.value,race:pe.human,position:{x:0,y:0},steps:0,items:[],...e})}},He=["blood_red","blood_red1","blood_red2","blood_red3","blood_red4"];const $e=class{constructor({core:e,scene:t,name:a,mapX:s,mapY:i,life:r=100}){const n=a??He[Math.floor(Math.random()*He.length)];this.core=e,this.name=n,this.life=r,this.maxLife=r,this.mapX=s,this.mapY=i,this.scene=t,this.mainMap=t.mainMap,this.makePrim()}makePrim=()=>{const{core:e,name:t}=this,{textures:{tx_main:a}}=e,i=new s.jyi(a[`${t}`]);i.interactive=!1,this.sprite=i,this.sprite.alpha=this.life/this.maxLife};getPrim=e=>this.sprite;doSomething(){if(this.life<0)return this.getPrim().destroy(),this.isDie=!0,void this.scene.refreshMonsters();this.sprite.alpha=this.life/this.maxLife,this.life--}update=()=>{const{mainMap:e,mapX:t,mapY:a,sprite:s}=this;s.x=e.mapContainer.x+t*v,s.y=e.mapContainer.y+a*v}};var Ge=a(443);const De=class{constructor({core:e,x:t=0,y:a=0,value:i=100,width:r=200,height:n=8,fillColor:o="#f6ff00",backgroundColor:h="#ff0000",borderColor:c="#ffffff"}){this.core=e;const p=(new s.TCu).beginFill(c).drawRoundedRect(0,0,r,n,1).beginFill(h).drawRoundedRect(1,1,r-2,n-2,1),l=(new s.TCu).beginFill(c).drawRoundedRect(0,0,r,n,1).beginFill(o).drawRoundedRect(1,1,r-2,n-2,1);this.progressBar=new Ge.k({bg:p,fill:l,progress:i}),this.progressBar.x=t,this.progressBar.y=a}getPrim=e=>this.progressBar;setValue=e=>{this.progressBar.progress=e}};const Ae=class extends Re{constructor({core:e,scene:t,monsterSetting:a}){const{lv:s,skin:i,characterName:r,currentBehavior:n,speed:o,maxHp:h,maxMp:c,expReward:p,expGold:l,gender:d,race:m}=a;super({core:e,scene:t,status:new Pe({lv:s,hp:h,maxHp:h,mp:c,maxMp:c,gender:d,race:m,expGold:l,expReward:p,speed:o,characterName:r,currentBehavior:n})}),this.status.mapX=0,this.status.mapY=0;const{mainMap:u}=t;this.mainMap=u,this.mainMap.addResetCallback((e=>{this.respawn()})),this.skin=i,this.makePrim()}updateProgressBar=e=>{const{hp:t,maxHp:a,mp:s,maxMp:i}=this;this.progressHp.setValue(t/a*100),this.progressMp.setValue(s/i*100)};makePrim=()=>{const{core:e,skin:t}=this,{textures:{tx_main:a}}=e,i=new s.jyi(a[`${t}`]);i.interactive=!1,this.sprite=i,this.progressHp=new De({core:e,y:32,borderColor:"#000000",width:33,height:3}),this.progressMp=new De({core:e,fillColor:"#0f0fff",backgroundColor:"#ff0f0f",borderColor:"#000000",y:35,width:32,height:3}),this.container.addChild(this.sprite),this.container.addChild(this.progressHp.getPrim()),this.maxMp&&this.container.addChild(this.progressMp.getPrim()),this.updateProgressBar()};getStatus=e=>this.status;respawn=e=>this.spawn();spawn=e=>{const t=this.scene.playerMapX,a=this.scene.playerMapY;let s={x:-1,y:-1};do{s=this.mainMap.getRespawnPosition()}while(t===s.x||a===s.y);this.status.hp=this.status.maxHp,this.move(s.x,s.y)};trappedIn=({dmg:e,difficulty:t})=>{const{addText:a,status:s,characterName:i}=this,r=t<=this.diceRoll({diceText:"1d20+dex",status:s})?0:this.diceRoll({diceText:e});return!!r&&(a(`${i}\u304c\u3001\u7f60\u306b\u30cf\u30de\u3063\u3066\u3089\uff01`),this.applyDamage({point:r,silent:!0}),!0)};died(e){this.addText(`${this.characterName}\u306f\u3001 \u3057  \u3093  \u3060  \u3088`),e&&e.applyExp(this),this.getPrim().destroy(),this.isDie=!0,this.scene.refreshMonsters();const{core:t,scene:a,mapX:s,mapY:i}=this;this.scene.addTrace(new $e({core:t,scene:a,mapX:s,mapY:i}))}moveTowardsTarget=e=>{const t=e.mapX,a=e.mapY;Math.random()<.5?t<this.status.mapX?this.status.trialMove("l"):t>this.status.mapX&&this.status.trialMove("r"):a<this.status.mapY?this.status.trialMove("u"):a>this.status.mapY&&this.status.trialMove("d")};getTargetDistance=e=>p(e,this);checkCollision=e=>{const{mainMap:t}=this,{virtualX:a,virtualY:s,isWindowOpen:i,currentBehavior:r}=this.status,n=t.getTile(a,s),o=this.uuid,h=this.scene.getEnemys().filter((({uuid:e,status:{mapX:t,mapY:i}})=>e!=o&&t===a&&i===s)),c=this.scene.getPlayer(),p=c.mapX,l=c.mapY;return a==p&&s==l&&h.push(c),h.forEach((e=>{const[t,a]=this.determineInitiative([this,e]);r===de||i||(r===ue||t.isPlayer||a.isPlayer)&&(t.isPlayer||this.weaponAttack({offense:t,defense:a}),a.isPlayer||this.weaponAttack({offense:a,defense:t}))})),n.hit({actor:this,status:status})||h.length};doSomething(){const{status:e,status:{beforeUpdate:t,afterUpdate:a,isMove:s}}=this;t();const i=this.selectAttackTarget();if(i){this.getTargetDistance(i)<15&&this.moveTowardsTarget(i)}if(!s())return;const{virtualX:r,virtualY:n}=e;this.checkCollision(i)||this.moveConfirmed(r,n),a()}update=e=>{super.update(e);const{mainMap:t,status:a,mainContainer:s}=this;s.x=t.mapContainer.x+a.mapX*v,s.y=t.mapContainer.y+a.mapY*v,this.updateProgressBar()}};const Ie=class{constructor(e){this.gameScene=e,this.layer=new s.W20,this.contianerMonster=new s.W20,this.contianerTrace=new s.W20,this.levelMsMonster=Array(9).fill().map((e=>[])),this.levelMonster=Array(9).fill().map((e=>[])),this.levelTrace=Array(9).fill().map((e=>[])),this.layer.addChildAt(this.contianerMonster),this.layer.addChildAt(this.contianerTrace);for(let t=0;t<9;t++)this.levelMsMonster[t]=Be.filter((({spawnStartLv:e,spawnEndLv:a})=>t>=e&&t<=a))}getPrim=e=>this.layer;spawnEnemy=e=>{const{core:t,level:a}=this.gameScene,s=this.levelMonster[a],i=this.gameScene;s.length>=20||(Array.from({length:5},(e=>{const s=this.levelMsMonster[a].length;if(s<1)return;const r=this.levelMsMonster[a][Math.floor(Math.random()*s)],n=new Ae({core:t,scene:i,monsterSetting:r});n.respawn(),this.levelMonster[a].push(n)})),this.reset(a))};addTrace=e=>this.contianerTrace.addChild(e.getPrim());reset=(e=0)=>{this.setLevelMonster(e)};refreshMonsters(){const{level:e}=this.gameScene,t=this.levelMonster[e].filter((e=>e.isDie)).map((({uuid:e})=>e));this.levelMonster[e]=this.levelMonster[e].filter((e=>!e.isDie)),this.levelTrace[e]=this.levelTrace[e].filter((e=>!e.isDie)),t.length&&this.levelMonster[e].forEach((e=>{e.applyTargetsIds(t)})),this.reset(e)}setLevelMonster=e=>{this.contianerMonster.removeChildren(),this.contianerTrace.removeChildren();const t=this.levelMonster[e],a=this.levelTrace[e];t.forEach((e=>{e.makePrim(),this.contianerMonster.addChild(e.getPrim())})),a.forEach((e=>{e.makePrim(),this.contianerTrace.addChild(e.getPrim())})),this.gameScene.monsters=this.levelMonster[e],this.gameScene.traces=this.levelTrace[e]}};const We=class{constructor(){this.msgs=[],this.infoMsgs=[],this.dispText="";const e=new s.W20;e.x=8,e.y=400;const t=new s.TCu;t.lineStyle(2,16777215,1),t.beginFill(71830,.75),t.drawRoundedRect(0,0,600,128,8),t.endFill();const a=new s.xvT("",{fontSize:14,fill:16777215,align:"left"});a.x=6,a.y=6,this.textPrim=a,t.addChild(a),e.addChild(t),this.prim=e,this.close()}open=e=>this.prim.visible=!0;close=e=>this.prim.visible=!1;resize=(e,t)=>{this.prim.x=8,this.prim.y=t-128-64};getPrim=e=>this.prim;addText=e=>{e.split("\n").forEach((e=>this.msgs.push({text:e}))),this.infoMsgs=this.msgs.slice(-7),this.dispText=this.infoMsgs.map((({text:e})=>`${e}`)).join("\n")};update=e=>{""!==this.textPrim.text&&this.open(),this.textPrim.text!==this.dispText&&(this.textPrim.text=this.dispText)}};const Xe=class{constructor({core:e,scene:t}){const{app:{screen:{height:a}}}=e,{player:i}=t;this.core=e,this.scene=t,this.player=i,this.container=new s.W20,this.primText=new s.xvT("",{fontSize:20,fill:16777215,align:"left"}),this.progressHp=new De({core:e,y:24}),this.progressMp=new De({core:e,fillColor:"#0f0fff",backgroundColor:"#ff0f0f",y:34}),this.container.addChild(this.primText),this.container.addChild(this.progressHp.getPrim()),this.container.addChild(this.progressMp.getPrim()),this.container.x=10,this.container.y=a+-60}getPrim=e=>this.container;resize=(e,t)=>{this.container.x=10,this.container.y=t+-60};update=e=>{const{lv:t,hp:a,maxHp:s,mp:i,maxMp:r,mapX:n,mapY:o,steps:h,exp:c,nextExp:p}=this.player.getStatus(),{level:l}=this.scene;this.primText.text=`LV:${t} HP:${a}/${s} MP: ${i}/${r} STEP ${h} : (${n},${o}) ${l+1}F: EXP:${c}/${p}`,this.progressHp.setValue(a/s*100),this.progressMp.setValue(i/r*100)}},Ye=12;const qe=class{constructor({core:e,scene:t,x:a=0,y:i=0,w:r=0,h:n=0,menu:o}){this.isOpen=!1,this.hasMenu=!o,this.core=e,this.scene=t;const h=new s.W20;this.prim=h,this.oldKeymap=[],this.x=a,this.y=i,this.w=r,this.h=n,this.isLock=!0,this.isForceLock=!1,this.inputMap={w:e=>this.up(),s:e=>this.down(),ArrowRight:e=>this.selected(),ArrowUp:e=>this.up(),ArrowDown:e=>this.down()},o&&this.setMenu(o)}rowHeight=e=>Math.min(Ye,this.menuLength);setMenu=e=>{const t=e.map((({label:e})=>`${e}`));this.menuText=t.join("\n"),this.menuLength=e.length,this.menuOffsetPosition=0,this.longest=t.reduce(((e,t)=>Math.max(e,t.length)),0),this.menu=e,this.select=0,this.cursolPosition=0,this.w=v*this.longest+16,this.h=v*this.rowHeight()+4};selected(){const{isOpen:e,menu:t,select:a}=this;e&&t[a].action()}createTextContainer(){const e=new s.W20;return this.textPrims=Array(this.rowHeight()).fill().map(((t,a)=>((t=new s.xvT("",{fontSize:28,fill:g,align:"left",lineHeight:32})).setTransform(this.x+4,this.y+4+32*a),e.addChild(t),t))),e}open(){const e=this.prim;e.removeChildren();const t=new s.TCu;t.lineStyle(2,16777215,1),t.beginFill(71830,.75),t.drawRoundedRect(this.x,this.y,this.w,this.h+4,4),t.endFill(),e.addChild(t);const a=new s.TCu;a.lineStyle(2,16777215,1),a.drawRoundedRect(this.x+2,this.y,this.w-4,v,2),e.addChild(a),this.textContainer=this.createTextContainer(),e.addChild(this.textContainer),this.panelPrim=t,this.cursolPrim=a,this.isOpen=!0,this.delayFrame=1,this.unLock(),this.cursolPrim.y=this.cursolPosition*v+4,this.updateMenuText()}leftSideX=e=>this.x+this.w;close(){this.prim.removeChildren(),this.isOpen=!1,this.lock()}lock=e=>this.isLock=!0;unLock=e=>this.isLock=!1;forceLock=e=>this.isForceLock=!0;forceUnLock=e=>this.isForceLock=!1;getPrim=e=>this.prim;updateMenuText(){const{menu:e,menuOffsetPosition:t}=this,a=t,s=a+Ye;this.textPrims.forEach((e=>e.text="")),e.slice(a,s).forEach((({label:e,color:t=16777215},a)=>{this.textPrims[a].style.fill=t,this.textPrims[a].text=e}))}up=e=>{this.isOpen&&(this.select--,this.cursolPosition--,this.cursolPosition<0&&(this.menuLength<11?(this.cursolPosition=this.menuLength-1,this.select=this.menuLength-1,this.menuOffsetPosition=0):this.select<0?(this.cursolPosition=11,this.select=this.menuLength-1,this.menuOffsetPosition=Math.max(this.menuLength-Ye,0)):(this.cursolPosition=0,this.menuOffsetPosition=Math.max(0,this.menuOffsetPosition-1))),this.updateMenuText(),this.cursolPrim.y=this.cursolPosition*v+4)};down=e=>{this.isOpen&&(this.select++,this.cursolPosition++,this.cursolPosition>this.rowHeight()-1&&(this.select>=this.menuLength?(this.cursolPosition=0,this.select=0,this.menuOffsetPosition=0):(this.cursolPosition=11,this.menuOffsetPosition=Math.min(this.menuLength-Ye,this.menuOffsetPosition+1))),this.updateMenuText(),this.cursolPrim.y=this.cursolPosition*v+4)};update(e){const{input:t}=this.core,{inputMap:a,oldKeymap:s,isLock:i,isForceLock:r,singleUpdate:n,delayFrame:o}=this;if(0!==o)return void(this.delayFrame-=1);if(i||r)return!0;return s===Object.keys(a).map((e=>!!t.isSingleDown(e))).join(",")||(n(e),this.oldKeymap=Object.keys(a).map((e=>!!t.isSingleDown(e))).join(","),!1)}singleUpdate=()=>{const{inputMap:e,core:{input:t}}=this,a=Object.keys(e).find((e=>t.isSingleDown(e)));a&&e[a]()};getCursolPosition=e=>({x:this.cursolPrim.x,y:this.cursolPrim.y})};const Oe=class extends qe{constructor({core:e,scene:t,x:a=0,y:s=0}){super({core:e,scene:t,x:a,y:s,maxlabels:10}),this.inputMap={ArrowLeft:e=>this.closeMenu(),ArrowRight:e=>this.selected()}}closeMenu=e=>this.isOpen&&this.scene.uiWindowManager.closeConfirmWindow(this);open(e=(e=>{})){const t=[{label:"\u2190\u4f7f\u308f\u306a\u3044\u3000/\u3000\u4f7f\u3046\u2192",action:t=>{const{scene:{uiWindowManager:a}}=this;e(),a.closeConfirmWindow(this)}}];this.setMenu(t),super.open()}update=e=>super.update(e)};const ze=class extends qe{constructor({core:e,scene:t,x:a=0,y:s=0}){super({core:e,scene:t,x:a,y:s,maxlabels:10}),this.inputMap={ArrowLeft:e=>this.closeMenu(),w:e=>{this.up(),this.selected()},s:e=>{this.down(),this.selected()},ArrowUp:e=>{this.up(),this.selected()},ArrowDown:e=>{this.down(),this.selected()}}}closeMenu=e=>this.isOpen&&this.scene.uiWindowManager.closeEquipmentMenu();open(){const e=this.scene.getPlayer(),t=e.equipmentItems(),a=t.length?t.map(((t,a)=>{const s=e.isItemEquipped(t);return{label:t.itemName,color:s?w:super.DEFAULT_TEXT_COLOR,action:s=>{this.scene.uiWindowManager.openItemStatusWindow(this,(()=>{new t.itemLogicClass(this.core,this.scene,t).equipment(e)&&e.equipment(t,a),this.closeMenu()}),t)}}})):[{label:"\u88c5\u5099\u3067\u304d\u308b\u3082\u306e\u304c\u306a\u3044\uff01",action:e=>{const{scene:{uiWindowManager:t}}=this;t.closeEquipmentMenu()}}];this.setMenu(a),super.open(),t.length&&this.selected()}};const Ue=class extends qe{constructor({core:e,scene:t,x:a=0,y:s=0}){super({core:e,scene:t,x:a,y:s,w:640,h:320}),this.inputMap={ArrowRight:e=>this.selected()},this.action=e=>{},this.item={}}open(e=(e=>{}),t={}){this.action=e,this.item=t;const a=new t.itemLogicClass(this.core,this.scene,t).getStringValue(),i=`\n\u30a2\u30a4\u30c6\u30e0\u540d\uff1a${t.itemName}\n\u30a2\u30a4\u30c6\u30e0\u30bf\u30a4\u30d7\uff1a${t.itemTypeName}\n${t.valueLabel}\uff1a${a}\n`.replace(/^\s+/,""),r=this.prim;r.removeChildren();const n=new s.xvT(i,{fontSize:28,fill:16777215,align:"left",lineHeight:v});n.setTransform(this.x+8,this.y+4);const o=new s.TCu;o.lineStyle(2,16777215,1),o.beginFill(71830,.75),o.drawRoundedRect(this.x,this.y,this.w,this.h+4,4),o.endFill(),r.addChild(o),r.addChild(n),this.textPrim=n,this.panelPrim=o,this.isOpen=!0,this.delayFrame=1,this.unLock()}selected(){const{isOpen:e}=this;e&&this.action(this.item)}};const je=class extends qe{constructor({core:e,scene:t,x:a=0,y:s=0}){super({core:e,scene:t,x:a,y:s,maxlabels:10}),this.inputMap={ArrowLeft:e=>this.closeMenu(),w:e=>{this.up(),this.selected()},s:e=>{this.down(),this.selected()},ArrowRight:e=>e=>{},ArrowUp:e=>{this.up(),this.selected()},ArrowDown:e=>{this.down(),this.selected()}}}closeMenu=e=>this.isOpen&&this.scene.uiWindowManager.closeItemMenu();open(){const e=this.scene.getPlayer(),t=e.items(),a=t.length?t.map(((t,a)=>{const s=e.isItemEquipped(t);return{label:t.itemName,color:s?w:super.DEFAULT_TEXT_COLOR,action:s=>{this.scene.uiWindowManager.openItemStatusWindow(this,(()=>{new t.itemLogicClass(this.core,this.scene,t).use(e)&&this.scene.player.itemUsed(t,a),this.closeMenu()}),t)}}})):[{label:"\u306a\u306b\u3082\u6301\u3063\u3066\u3044\u306a\u3044\uff01",action:e=>{const{core:{uiWindowManager:t}}=this;t.closeItemMenu()}}];this.setMenu(a),super.open(),t.length&&this.selected()}};const Ve=class extends qe{constructor({core:e,scene:t,x:a=0,y:s=0}){super({core:e,scene:t,x:a,y:s,w:640,h:320}),this.inputMap={ArrowRight:e=>this.selected()},this.action=e=>{},this.magic={}}open(e=(e=>{}),t={}){const{status:a}=this.scene.getPlayer();this.action=e,this.magic=t;const i=new t.magicLogicClass(this.core,this.scene,t).getStringValue(a),r=`\n\u9b54\u6cd5\u540d\uff1a${t.magicName}\n\u9b54\u6cd5\u30bf\u30a4\u30d7\uff1a${t.magicTypeName}\n\u9b54\u6cd5\u5c5e\u6027\uff1a${Ne[t.magicAttribute]}\n${t.valueLabel}\uff1a${i}\n`.replace(/^\s+/,""),n=this.prim;n.removeChildren();const o=new s.xvT(r,{fontSize:28,fill:16777215,align:"left",lineHeight:v});o.setTransform(this.x+8,this.y+4);const h=new s.TCu;h.lineStyle(2,16777215,1),h.beginFill(71830,.75),h.drawRoundedRect(this.x,this.y,this.w,this.h+4,4),h.endFill(),n.addChild(h),n.addChild(o),this.textPrim=o,this.panelPrim=h,this.isOpen=!0,this.delayFrame=1,this.unLock()}selected(){const{isOpen:e}=this;e&&this.action(this.magic)}};const Fe=class extends qe{constructor({core:e,scene:t,x:a=0,y:s=0}){super({core:e,scene:t,x:a,y:s,maxlabels:10}),this.inputMap={ArrowLeft:e=>this.closeMenu(),w:e=>{this.up(),this.selected()},s:e=>{this.down(),this.selected()},ArrowRight:e=>e=>{},ArrowUp:e=>{this.up(),this.selected()},ArrowDown:e=>{this.down(),this.selected()}}}closeMenu=e=>this.isOpen&&this.scene.uiWindowManager.closeMagicMenu();open(){const e=this.scene.getPlayer(),t=e.magics(),a=t.length?t.map((t=>({label:t.magicName,color:super.DEFAULT_TEXT_COLOR,action:a=>{this.scene.uiWindowManager.openMagicStatusWindow(this,(()=>{new t.magicLogicClass(this.core,this.scene,t).use(e)&&this.scene.player.magicUsed(t),this.closeMenu()}),t)}}))):[{label:"\u307e\u3060\u3001\u306a\u306b\u3082\u899a\u3048\u3066\u3044\u306a\u3044\u3002\u52c9\u5f37\u4e0d\u8db3\u3060\uff01",action:e=>{const{core:{uiWindowManager:t}}=this;t.closeMagicMenu()}}];this.setMenu(a),super.open(),t.length&&this.selected()}};const Ke=class extends qe{constructor({core:e,scene:t}){super({x:v,y:v,core:e,scene:t}),this.setMenu([{label:"\u3069\u3046\u3050",action:this.selectItemMenu},{label:"\u307e\u307b\u3046",action:this.selectMagicMenu},{label:"\u305d\u3046\u3073",action:this.selectEqipmentMenu},{label:"\u3064\u3088\u3055",action:this.selectStatus},{label:"\u3059\u3066\u308b",action:e=>{console.log("\u3059\u3066\u308b")}},{label:"\u30bb\u30fc\u30d6",action:t=>{e.save(),console.log("\u30bb\u30fc\u30d6")}}]),this.inputMap.ArrowLeft=e=>this.scene.uiWindowManager.close()}selectItemMenu=e=>{const{scene:{uiWindowManager:t}}=this;t.openItemMenu()};selectMagicMenu=e=>{const{scene:{uiWindowManager:t}}=this;t.openMagicMenu()};selectEqipmentMenu=e=>{const{scene:{uiWindowManager:t}}=this;t.openEquipmentMenu()};selectStatus=e=>{const{scene:{uiWindowManager:t}}=this;t.openStatusWindow()};open(){const{scene:{windowOpen:e}}=this;super.open(),e(this.isOpen)}close(){const{windowOpen:e}=this.scene;super.close(),e(this.isOpen)}},Ze=(e="",t,a="\u3000")=>`${e}`.padEnd(t,a).slice(0,t);const Je=class extends qe{constructor({core:e,scene:t,x:a=0,y:s=0}){super({core:e,scene:t,x:a,y:s,w:640,h:480}),this.inputMap={ArrowLeft:e=>this.isOpen&&this.scene.uiWindowManager.closeStatusWindow()},this.action=e=>{}}open(){const e=this.scene.getPlayerStatus(),{armour:t,weapon:a,ring:i,shield:r}=e.equipments,n=`\u30ec\u30d9\u30eb\uff1a${Ze(e.lv,4," ")} \u540d\u524d\uff1a${Ze(e.name,8)}\nHP\uff1a${Ze(e.hp,5," ")}/${Ze(e.maxHp,5," ")} MP\uff1a${Ze(e.mp,5," ")}/${Ze(e.maxMp,5," ")}\n\u5f37\u3055:${e.str}(${h(e.str,e.modifiers.str)})\n\u4fca\u654f\u3055:${e.dex}(${h(e.dex,e.modifiers.dex)})\n\u5f37\u976d\u3055:${e.con}(${h(e.con,e.modifiers.con)})\n\u77e5\u6027:${e.intl}(${h(e.intl,e.modifiers.intl)})\n\u77e5\u6075:${e.wiz}(${h(e.wiz,e.modifiers.wiz)})\n\u30ab\u30ea\u30b9\u30de:${e.cha}(${h(e.cha,e.modifiers.cha)})\n\n  \u6b66\u5668\uff1a${a.itemName}\n  \u93a7  \uff1a${t.itemName}\n  \u76fe  \uff1a${r.itemName}\n  \u6307\u8f2a\uff1a${i.itemName}\n\n`,o=this.prim;o.removeChildren();const c=new s.xvT(n,{fontSize:28,fill:16777215,align:"left",lineHeight:32});c.setTransform(this.x+8,this.y+4);const p=new s.TCu;p.lineStyle(2,16777215,1),p.beginFill(71830,.75),p.drawRoundedRect(this.x,this.y,this.w,this.h+4,4),p.endFill(),o.addChild(p),o.addChild(c),this.textPrim=c,this.panelPrim=p,this.isOpen=!0,this.delayFrame=1,this.unLock()}};const Qe=class{constructor({core:e,scene:t}){this.core=e,this.scene=t,this.mainWindow=new Ke({core:e,scene:t});const{x:a,y:i,w:r}=this.mainWindow;this.itemWindow=new je({core:e,scene:t,x:a+r,y:i}),this.equipmentWindow=new ze({core:e,scene:t,x:a+r,y:i}),this.confirmWindow=new Oe({core:e,scene:t}),this.statusWindow=new Je({core:e,scene:t,x:a+r,y:i}),this.itemStatusWindow=new Ue({core:e,scene:t}),this.magicWindow=new Fe({core:e,scene:t,x:a+r,y:i}),this.magicStatusWindow=new Ve({core:e,scene:t}),this.windows=[this.mainWindow,this.itemWindow,this.magicWindow,this.equipmentWindow,this.magicStatusWindow,this.itemStatusWindow,this.confirmWindow,this.statusWindow];const n=new s.W20;this.prim=n,this.windows.forEach(((e,t)=>n.addChildAt(e.getPrim(),t))),this.inputMap={e:e=>t.isWindowOpen?this.close():this.open()}}getMainWindowPos=e=>({x:this.mainWindow.x,y:this.mainWindow.y});getPrim=e=>this.prim;forceLockAll=e=>this.windows.forEach((e=>e.forceLock()));forceUnLockAll=e=>this.windows.forEach((e=>e.forceUnLock()));open=e=>{this.mainWindow.open()};openEquipmentMenu=e=>{this.mainWindow.lock(),this.equipmentWindow.open()};closeEquipmentMenu=e=>{this.itemStatusWindow.close(),this.equipmentWindow.close(),this.mainWindow.unLock()};closeEquipmentWindow=e=>{};openConfirmWindow=(e,t)=>{this.forceLockAll();const{x:a,y:s,w:i}=e,{y:r}=e.getCursolPosition();this.confirmWindow.x=a+i,this.confirmWindow.y=r+s,this.confirmWindow.open(t),this.confirmWindow.forceUnLock()};openItemMenu=e=>{this.mainWindow.lock(),this.itemWindow.open()};closeItemMenu=e=>{this.itemWindow.close(),this.itemStatusWindow.close(),this.mainWindow.unLock()};openItemStatusWindow=(e,t,a)=>{const{x:s,w:i}=e,{y:r}=this.getMainWindowPos();this.itemStatusWindow.x=s+i,this.itemStatusWindow.y=r,this.itemStatusWindow.open(t,a)};openMagicMenu=e=>{this.mainWindow.lock(),this.magicWindow.open()};closeMagicMenu=e=>{this.magicWindow.close(),this.magicStatusWindow.close(),this.mainWindow.unLock()};openMagicStatusWindow=(e,t,a)=>{const{x:s,w:i}=e,{y:r}=this.getMainWindowPos();this.magicStatusWindow.x=s+i,this.magicStatusWindow.y=r,this.magicStatusWindow.open(t,a)};openStatusWindow=e=>{this.mainWindow.lock(),this.statusWindow.open()};closeStatusWindow=e=>{this.statusWindow.close(),this.mainWindow.unLock()};closeItemStatusWindow=e=>{};closeConfirmWindow=e=>{this.confirmWindow.close(),this.forceUnLockAll()};close=e=>{for(const t of this.windows)t.close()};update=e=>{const{core:{input:t},inputMap:a}=this,s=Object.keys(a).find((e=>t.isSingleDown(e)));s&&a[s]();for(const i of this.windows)i.update(e)}};const et=class extends m{constructor({core:e}){super({core:e,sceneId:nt.GAME}),this.isWindowOpen=!1,this.sceneContainer=new s.W20,this.mapContainer=new s.W20,this.actorContainer=new s.W20,this.effectContainer=new s.W20,this.uiContainer=new s.W20,this.battleLogic=new d(e),this.effectManager=new x(e,this.effectContainer),this.levelMap=[],this.frameCounter=0}async Load(){return this.sound.add({iron_door_open:"./assets/sound/\u9244\u306e\u6249\u3092\u958b\u3051\u308b.mp3",bow_arrow_hit:"./assets/sound/\u5f13\u77e2\u304c\u523a\u3055\u308b.mp3",sword_slash_2:"./assets/sound/\u5263\u3067\u65ac\u308b2.mp3",strike_8:"./assets/sound/\u6253\u64838.mp3",unmute:"./assets/sound/\u6c7a\u5b9a\u30dc\u30bf\u30f3\u3092\u62bc\u305942.mp3"}),await this.effectManager.add({fireboll:{path:"./assets/particle/fireboll.json",imageId:"bolt04"},taki:{path:"./assets/particle/taki.json",imageId:"bolt04"}}),!0}updateMap=e=>{this.traces=[],this.monsters=[],this.mainMap=this.mapManager.getLevelMap(this.level),this.mapContainer.removeChildren(),this.mapContainer.addChild(this.mainMap.getPrim())};Initialize(){const{core:e,app:t}=this,a=this;this.mapContainer.removeChildren(),this.actorContainer.removeChildren(),this.effectContainer.removeChildren(),this.mapContainer.removeChildren(),this.uiContainer.removeChildren(),this.sceneContainer.removeChildren(),this.level=0,this.mapManager=new ne({core:e,scene:a}),this.spawnManager=new Ie(this),this.updateMap(),this.sceneContainer.addChild(this.mapContainer),this.sceneContainer.addChild(this.actorContainer),this.sceneContainer.addChild(this.effectContainer),this.sceneContainer.addChild(this.uiContainer),this.actorContainer.addChild(this.spawnManager.getPrim()),this.debugTextPrim=new s.xvT("debug key string",{fontSize:20,fill:16777215,align:"center"}),this.uiContainer.addChild(this.debugTextPrim),this.debugTextPrim.x=100,this.debugTextPrim.y=0,this.player=new _e({core:e,scene:a}),this.actorContainer.addChild(this.player.getPrim()),this.player.respawn(),this.monsters=[],this.traces=[],this.uiStatus=new Xe({core:e,scene:a}),this.uiContainer.addChild(this.uiStatus.getPrim()),this.uiWindowManager=new Qe({core:e,scene:a}),this.uiContainer.addChild(this.uiWindowManager.getPrim()),t.stage.addChild(this.sceneContainer),this.uiMessageBox=new We({core:e,scene:a}),this.uiContainer.addChild(this.uiMessageBox.getPrim())}refreshMonsters=e=>this.spawnManager.refreshMonsters();addTrace=e=>{this.spawnManager.addTrace(e),this.traces.push(e)};main(e){this.effectManager.update(e),this.mainMap.update(e),this.uiStatus.update(),this.player.update(e),this.traces.forEach((({update:t})=>{t(e)})),this.monsters.forEach((({update:t})=>{t(e)})),this.uiMessageBox.update(e),this.uiWindowManager.update(e),this.debugTextPrim.text=this.core.getDebugText();const{x:t,y:a}=this.mainMap.getPosition();this.core.setDebugText(1,`Monster Count:${this.monsters.length}`),this.core.setDebugText(2,"Counter:"+this.frameCounter++),this.core.setDebugText(3,`MapX:${t},MapY:${a},isLocked:${this.isWindowOpen}`)}goto=({next:{x:e,y:t,level:a}})=>{this.level=a,this.updateMap(),this.player.setMap(this.mainMap),this.player.teleportation(e,t),this.mainMap.center(e,t),this.resetSpawnManager(a);const{x:s,y:i}=this.mainMap.getPosition()};async Start(){const{app:e}=this;e.ticker.start()}Stop(){const{app:e}=this;e.ticker.stop()}resize(e,t){this.uiStatus.resize(e,t),this.uiMessageBox.resize(e,t),this.mainMap.center()}windowOpen=e=>this.isWindowOpen=e;windowClose=e=>this.uiWindowManager.close();addText=(e,t)=>this.uiMessageBox?.addText(e,t);getPlayer=e=>this.player;getPlayerStatus=e=>this.player.status;getEnemyById=e=>this.monsters.find((t=>t.uuid==e));getEnemys=e=>this.monsters;spawnEnemy=e=>this.spawnManager.spawnEnemy();resetSpawnManager=e=>this.spawnManager.reset(e);showEffect=({key:e,x:t,y:a})=>this.effectManager.setEffectPrim({key:e,x:t,y:a});handleStepUpdate=()=>{this.spawnEnemy(),this.monsters.map((e=>e.doSomething())),this.traces.map((e=>e.doSomething()))};play(e,t){let a=0;const{playerMapX:s,playerMapY:i}=this;let r=1;if(t){if(a=p(t,{mapX:s,mapY:i}),a>15)return;r=Math.max(0,1-a/15)}l.eq.play(e,{volume:r})}save=e=>{const t=this.getPlayerStatus().serialize(),a=this.mainMap.serialize();console.log(t),console.log(a),console.log("save game scene")};onMute(e){this.addText(e?"\u3042\u305f\u308a\u306f\u9759\u5bc2\u306b\u3064\u3064\u307e\u308c\u305f\uff01":"\u97f3\u3092\u76db\u5927\u306b\u9cf4\u3089\u3059\u3053\u3068\u306b\u306a\u3063\u305f\uff01"),e||this.play("unmute")}getEnemiesInRange=(e,t)=>this.battleLogic.getEnemiesInRange(e,t);isApproachActor=({pMapX:e,pMapY:t,mMapX:a,mMapY:s})=>this.battleLogic.isApproachEnemy({map:this.currentMap,pMapX:e,pMapY:t,mMapX:a,mMapY:s});get playerMapX(){return this.getPlayerStatus().mapX}get playerMapY(){return this.getPlayerStatus().mapY}get playerUUID(){return this.getPlayerStatus().uuid}get currentMap(){return this.mainMap}};const tt=class{constructor(){window.addEventListener("keydown",(e=>{this.okKeyDown(e)}),!1),window.addEventListener("keyup",(e=>{this.onKeyUp(e)}),!1),this.keyStatus={},this.snapshot={}}okKeyDown=e=>{e.preventDefault(),this.keyStatus[e.key]={down:!0,isSingleDown:!0}};onKeyUp=e=>{e.preventDefault(),this.keyStatus[e.key]={down:!1}};update=e=>{this.snapshot={...this.keyStatus},Object.keys(this.keyStatus).forEach((e=>{const{down:t,isSingleDown:a}=this.keyStatus[e];this.keyStatus[e]={down:t,isSingleDown:!t&&a}}))};isDown=e=>this.snapshot[e]?.down;isSingleDown=e=>this.snapshot[e]?.isSingleDown;getDebugString=e=>{let t="";return e.forEach((e=>{t=`${t}[${e}:${this.snapshot[e]?.down?"o":"x"}]`,t=`${t}[${e}:${this.snapshot[e]?.isSingleDown?"o":"x"}]`})),t}};var at=a(466),st=a.n(at),it=a(258);const rt=class{constructor({core:e,muteSwitchCallback:t=(e=>{})}){console.assert(e),this.core=e,this.container=new s.W20,this.soundCheckBox=new it.J({text:"",checked:!0,style:{unchecked:e.createSpriteByName("ui_sound_on"),checked:e.createSpriteByName("ui_sound_off")}}),this.soundCheckBox.onCheck.connect((e=>t(e))),this.setPosition(),this.container.addChild(this.soundCheckBox)}setPosition(){const e=this.core.getCanvasSize();this.soundCheckBox.x=e.width-this.soundCheckBox.width-8,this.soundCheckBox.y=e.height-this.soundCheckBox.height-8}update(){this.setPosition()}getPrim=e=>this.container},nt={GAME:"game"},ot=nt.GAME;const ht=class{constructor({isShowStats:e=!0}){const t=document.getElementById("contents"),{width:a,height:i}=this.getCanvasSize();this.app=new s.MxU({backgroundColor:0,width:a,height:i}),e&&(this.stats=new(st()),this.stats.showPanel(0),t.appendChild(this.stats.dom)),t.appendChild(this.app.view),this.loaded=!1,this.mainScale=1,this.debugText={},this.input=new tt;const r=new et({core:this});this.scenes={[r.getSceneId()]:r},this.sceneId=ot,this.changeScene(this.sceneId,!1),window.addEventListener("resize",(e=>{this.resize(e)}),!1),l.eq.muteAll()}changeScene=(e,t=!0)=>{this.sceneId=e,this.currentScene=this.scenes[e],t&&this.reset()};getScene=e=>this.scenes[e];setDebugText=(e,t)=>{this.debugText[`${e}`]=t};getDebugText=e=>Object.keys(this.debugText).sort().map((e=>`${this.debugText[e]}`)).join("\n");resize=e=>{const{width:t,height:a}=this.getCanvasSize();this.app.renderer.resize(t,a),this.currentScene.resize(t,a)};getCanvasSize=e=>({width:2*Math.floor(window.innerWidth/2),height:2*Math.floor(window.innerHeight/2)});reset=async e=>{await this.Load()?(await this.Initialize(),await this.Start()):console.error("Resource not loaded.")};muteSwitchCallback=e=>{e?l.eq.muteAll():l.eq.unmuteAll(),this.currentScene.onMute(e)};Load=async e=>{this.loaded=!0;const{textures:t}=await s.deM.load("./assets/sprites/main.json",(e=>console.info(e)));return this.textures={},t.ui_sound_on=s.xEZ.from("./assets/sprites/icons/outline_volume_up_white_24dp.png"),t.ui_sound_off=s.xEZ.from("./assets/sprites/icons/outline_volume_off_white_24dp.png"),this.textures.tx_main=t,this.uiCommon=new rt({core:this,muteSwitchCallback:this.muteSwitchCallback}),await this.currentScene.Load()};Initialize=async e=>{console.assert(this.loaded,"Resource not loaded."),this.app.stage.removeChildren(),this.currentScene.Initialize(),this.app.stage.addChild(this.uiCommon.getPrim()),this.resize()};Start=async e=>{const{app:t}=this;this.currentScene.Start(),t.ticker.add((e=>{const{app:t,stats:a,mainScale:s}=this;t.stage.scale.x=s,t.stage.scale.y=s,this.input.update(),this.setDebugText(0,this.input.getDebugString(["w","a","d","s","z","e"])),a.begin(),this.input.isDown("z")&&this.Initialize(),this.currentScene.main(e),this.uiCommon.update(e),a.end()}))};isKeyDown=e=>this.input.isDown(e);isKeyUp=e=>!this.input.isDown(e);getTexture=e=>this.textures.tx_main[e];diceRoll=({diceText:e,status:t})=>r({diceText:e,status:t});getPlayer=e=>this.currentScene.getSceneId()===nt.GAME?this.currentScene.getPlayer():null;getPlayerStatus=e=>this.currentScene.getSceneId()===nt.GAME?this.currentScene.getPlayerStatus():null;createSpriteByName=e=>{const{textures:{tx_main:t}}=this;return new s.jyi(t[`${e}`])};save=e=>{this.getScene(nt.GAME).save()}};(async e=>{const t=new ht({isShowStats:!0});await t.reset()})()},654:()=>{}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={id:s,loaded:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=e,(()=>{var e=[];a.O=(t,s,i,r)=>{if(!s){var n=1/0;for(p=0;p<e.length;p++){for(var[s,i,r]=e[p],o=!0,h=0;h<s.length;h++)(!1&r||n>=r)&&Object.keys(a.O).every((e=>a.O[e](s[h])))?s.splice(h--,1):(o=!1,r<n&&(n=r));if(o){e.splice(p--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var p=e.length;p>0&&e[p-1][2]>r;p--)e[p]=e[p-1];e[p]=[s,i,r]}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={179:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var i,r,[n,o,h]=s,c=0;if(n.some((t=>0!==e[t]))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(h)var p=h(a)}for(t&&t(s);c<n.length;c++)r=n[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(p)},s=self.webpackChunkpixijs_boilerplate=self.webpackChunkpixijs_boilerplate||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=a.O(void 0,[555],(()=>a(374)));s=a.O(s)})();