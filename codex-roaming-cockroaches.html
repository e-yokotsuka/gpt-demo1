<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="ai.author" content="ChatGPT-5.3-Codex">
  <meta name="ai.note" content="This file was generated by ChatGPT-5.3-Codex.">
  <title>Roaming Cockroaches - ChatGPT-5.3-Codex</title>
  <style>
    :root {
      --bg0: #0f0d0c;
      --bg1: #1c1713;
      --hud: rgba(13, 11, 10, 0.62);
      --line: rgba(255, 222, 184, 0.2);
      --text: #e8dcc8;
      --muted: #b8a98d;
      --danger: #ff9a7c;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      overflow: hidden;
      min-height: 100vh;
      background:
        radial-gradient(circle at 30% 10%, rgba(255, 214, 156, 0.08), transparent 35%),
        radial-gradient(circle at 80% 88%, rgba(122, 88, 64, 0.12), transparent 32%),
        linear-gradient(160deg, var(--bg0), var(--bg1));
      font-family: "Segoe UI", sans-serif;
      color: var(--text);
    }
    #stage {
      position: fixed;
      inset: 0;
      overflow: hidden;
      cursor: crosshair;
    }
    .roach {
      position: absolute;
      width: 64px;
      height: 64px;
      transform-origin: 50% 50%;
      will-change: transform, left, top;
      filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.45));
      pointer-events: none;
    }
    .roach img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      user-select: none;
      -webkit-user-drag: none;
      opacity: 0.98;
    }
    .roach.is-running img {
      filter: saturate(1.15) contrast(1.06);
    }
    .hud {
      position: fixed;
      left: 12px;
      top: 12px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: var(--hud);
      backdrop-filter: blur(3px);
      font-size: 12px;
      line-height: 1.6;
    }
    .hud b { color: #fff3dd; }
    .warn { color: var(--danger); }
    .footnote {
      position: fixed;
      right: 12px;
      bottom: 12px;
      color: var(--muted);
      font-size: 11px;
      background: var(--hud);
      padding: 7px 10px;
      border: 1px solid var(--line);
      border-radius: 999px;
    }
  </style>
</head>
<body>
  <div id="stage"></div>
  <div class="hud">
    <div><b>Roaming Cockroaches (Codex 5.3)</b></div>
    <div>Count: <span id="count">0</span></div>
    <div>Mouse repel: <span class="warn">ON</span></div>
    <div>Click: cockroaches increase</div>
  </div>
  <div class="footnote">Real image sprites + wandering AI</div>

  <script>
    const STAGE = document.getElementById("stage");
    const countEl = document.getElementById("count");

    const SPRITES = ["gokiburi1.png", "gokiburi2.png", "gokiburi3.png"];
    const roaches = [];
    let W = window.innerWidth;
    let H = window.innerHeight;
    let mouse = { x: W * 0.5, y: H * 0.5, active: false };

    function rand(min, max) {
      return Math.random() * (max - min) + min;
    }

    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    function makeRoach(x = rand(50, W - 50), y = rand(50, H - 50)) {
      const el = document.createElement("div");
      el.className = "roach";
      const img = document.createElement("img");
      img.src = SPRITES[(Math.random() * SPRITES.length) | 0];
      img.alt = "cockroach";
      el.appendChild(img);
      STAGE.appendChild(el);

      const size = rand(44, 76);
      const speed = rand(0.55, 1.55);
      const roach = {
        el,
        img,
        x,
        y,
        vx: rand(-1, 1),
        vy: rand(-1, 1),
        angle: rand(0, Math.PI * 2),
        targetAngle: rand(0, Math.PI * 2),
        speed,
        walkPhase: rand(0, Math.PI * 2),
        turnBias: rand(-0.03, 0.03),
        panic: 0,
        size
      };
      roaches.push(roach);
      countEl.textContent = String(roaches.length);
      return roach;
    }

    function applyTransform(r) {
      const walk = Math.sin(r.walkPhase) * (r.panic > 0.1 ? 0.08 : 0.04);
      const bodyScaleY = 1 + Math.sin(r.walkPhase * 2) * 0.03;
      const s = r.size / 64;
      r.el.style.width = `${r.size}px`;
      r.el.style.height = `${r.size}px`;
      r.el.style.left = `${r.x - r.size * 0.5}px`;
      r.el.style.top = `${r.y - r.size * 0.5}px`;
      r.el.style.transform = `rotate(${r.angle + walk}rad) scale(${s}, ${s * bodyScaleY})`;
    }

    function normalizeAngle(a) {
      while (a > Math.PI) a -= Math.PI * 2;
      while (a < -Math.PI) a += Math.PI * 2;
      return a;
    }

    function stepRoach(r, dt) {
      if (Math.random() < 0.012) {
        r.targetAngle += rand(-1.0, 1.0);
      }

      const dxm = r.x - mouse.x;
      const dym = r.y - mouse.y;
      const md = Math.hypot(dxm, dym);
      const repelRange = 170;
      if (mouse.active && md < repelRange) {
        const threat = 1 - md / repelRange;
        const away = Math.atan2(dym, dxm);
        r.targetAngle = away + rand(-0.16, 0.16);
        r.panic = clamp(r.panic + threat * 0.2, 0, 1.4);
      } else {
        r.panic = Math.max(0, r.panic - dt * 1.35);
      }

      const edge = 64;
      if (r.x < edge) r.targetAngle = 0 + rand(-0.55, 0.55);
      else if (r.x > W - edge) r.targetAngle = Math.PI + rand(-0.55, 0.55);
      if (r.y < edge) r.targetAngle = Math.PI * 0.5 + rand(-0.55, 0.55);
      else if (r.y > H - edge) r.targetAngle = -Math.PI * 0.5 + rand(-0.55, 0.55);

      const ad = normalizeAngle(r.targetAngle - r.angle);
      const turnSpeed = 2.6 + r.panic * 5.2;
      r.angle += clamp(ad, -turnSpeed * dt, turnSpeed * dt) + r.turnBias;

      const baseSpeed = r.speed * (46 + r.panic * 100);
      r.vx = Math.cos(r.angle) * baseSpeed;
      r.vy = Math.sin(r.angle) * baseSpeed;
      r.x += r.vx * dt;
      r.y += r.vy * dt;
      r.x = clamp(r.x, 12, W - 12);
      r.y = clamp(r.y, 12, H - 12);

      const legRate = 13 + r.speed * 7 + r.panic * 12;
      r.walkPhase += dt * legRate;
      const running = r.panic > 0.2;
      r.el.classList.toggle("is-running", running);
      applyTransform(r);
    }

    for (let i = 0; i < 38; i++) makeRoach();

    let prev = performance.now();
    function frame(now) {
      const dt = Math.min(0.035, (now - prev) / 1000);
      prev = now;
      for (let i = 0; i < roaches.length; i++) stepRoach(roaches[i], dt);
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);

    window.addEventListener("resize", () => {
      W = window.innerWidth;
      H = window.innerHeight;
    });

    window.addEventListener("mousemove", (e) => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
      mouse.active = true;
    });

    window.addEventListener("mouseleave", () => {
      mouse.active = false;
    });

    window.addEventListener("click", (e) => {
      const burst = 4;
      for (let i = 0; i < burst; i++) {
        const a = rand(0, Math.PI * 2);
        const r = rand(6, 22);
        const nx = clamp(e.clientX + Math.cos(a) * r, 16, W - 16);
        const ny = clamp(e.clientY + Math.sin(a) * r, 16, H - 16);
        const roach = makeRoach(nx, ny);
        roach.panic = 1.1;
        roach.targetAngle = a + Math.PI;
        applyTransform(roach);
      }
    });
  </script>
</body>
</html>
