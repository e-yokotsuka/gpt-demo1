<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="ai.author" content="Claude">
	<meta name="ai.note" content="This file was generated by Claude.">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Daisy Bell Music Demo - Claude版</title>
	<style>
		body {
			margin: 0;
			background: #1a1a2e;
			color: #e0e0ff;
			font-family: 'Georgia', serif;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			min-height: 100vh;
		}
		h1 { font-size: 2rem; margin-bottom: 10px; color: #ffd700; }
		p { font-size: 1.1rem; color: #aab; margin: 5px 0 20px; }
		#playBtn {
			padding: 16px 40px;
			font-size: 1.2rem;
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: #fff;
			border: none;
			border-radius: 50px;
			cursor: pointer;
			transition: transform 0.2s, box-shadow 0.2s;
		}
		#playBtn:hover {
			transform: scale(1.05);
			box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
		}
		#playBtn:disabled { opacity: 0.5; cursor: default; transform: none; }
		canvas { margin-top: 20px; border-radius: 8px; }
		#lyrics { margin-top: 15px; font-size: 1.1rem; color: #ddd; font-style: italic; min-height: 1.5em; }
	</style>
</head>
<body>
	<h1>Daisy Bell</h1>
	<p>HAL 9000が歌った歴史的な曲</p>
	<button id="playBtn" onclick="play()">♪ Play Daisy Bell</button>
	<canvas id="visualizer" width="500" height="150"></canvas>
	<div id="lyrics"></div>

	<script>
		// Claudeによる Daisy Bell 実装
		// ビジュアライザー付き、エンベロープ制御
		const notes = [
			{ pitch: 76, dur: 300, lyric: "Dai-" },
			{ pitch: 76, dur: 150, lyric: "sy," },
			{ pitch: 79, dur: 300, lyric: "Dai-" },
			{ pitch: 76, dur: 300, lyric: "sy," },
			{ pitch: 81, dur: 600, lyric: "give me your" },
			{ pitch: 80, dur: 300, lyric: "an-" },
			{ pitch: 76, dur: 150, lyric: "swer" },
			{ pitch: 76, dur: 150, lyric: "do." },
			{ pitch: 79, dur: 300, lyric: "" },
			{ pitch: 76, dur: 300, lyric: "I'm" },
			{ pitch: 83, dur: 300, lyric: "half" },
			{ pitch: 81, dur: 600, lyric: "cra-zy" },
			{ pitch: 76, dur: 150, lyric: "all" },
			{ pitch: 76, dur: 150, lyric: "for" },
			{ pitch: 88, dur: 300, lyric: "the" },
			{ pitch: 84, dur: 300, lyric: "love" },
			{ pitch: 81, dur: 300, lyric: "of" },
			{ pitch: 80, dur: 300, lyric: "you." },
		];

		let audioCtx;
		let analyser;
		const canvas = document.getElementById('visualizer');
		const ctx = canvas.getContext('2d');
		let isPlaying = false;

		function play() {
			if (isPlaying) return;
			isPlaying = true;
			document.getElementById('playBtn').disabled = true;

			if (!audioCtx) {
				audioCtx = new (window.AudioContext || window.webkitAudioContext)();
				analyser = audioCtx.createAnalyser();
				analyser.fftSize = 256;
				analyser.connect(audioCtx.destination);
			}

			let time = audioCtx.currentTime + 0.1;
			const lyricsEl = document.getElementById('lyrics');

			for (const note of notes) {
				const osc = audioCtx.createOscillator();
				osc.type = 'sine';
				osc.frequency.value = 440 * Math.pow(2, (note.pitch - 69) / 12);

				const gain = audioCtx.createGain();
				const dur = note.dur / 1000;
				// エンベロープ
				gain.gain.setValueAtTime(0, time);
				gain.gain.linearRampToValueAtTime(0.3, time + 0.02);
				gain.gain.exponentialRampToValueAtTime(0.15, time + dur * 0.5);
				gain.gain.linearRampToValueAtTime(0.001, time + dur - 0.01);

				osc.connect(gain);
				gain.connect(analyser);

				osc.start(time);
				osc.stop(time + dur);

				// 歌詞の表示
				const noteTime = time;
				const lyric = note.lyric;
				setTimeout(() => { lyricsEl.textContent = lyric; }, (noteTime - audioCtx.currentTime) * 1000);

				time += dur;
			}

			// 再生終了後にリセット
			setTimeout(() => {
				isPlaying = false;
				document.getElementById('playBtn').disabled = false;
				document.getElementById('lyrics').textContent = '';
			}, (time - audioCtx.currentTime) * 1000 + 500);

			drawVisualizer();
		}

		function drawVisualizer() {
			if (!analyser) return;
			const bufferLength = analyser.frequencyBinCount;
			const dataArray = new Uint8Array(bufferLength);

			function draw() {
				requestAnimationFrame(draw);
				analyser.getByteFrequencyData(dataArray);

				ctx.fillStyle = 'rgba(26, 26, 46, 0.3)';
				ctx.fillRect(0, 0, canvas.width, canvas.height);

				const barWidth = canvas.width / bufferLength * 2;
				for (let i = 0; i < bufferLength; i++) {
					const barHeight = (dataArray[i] / 255) * canvas.height;
					const hue = (i / bufferLength) * 240 + 200;
					ctx.fillStyle = `hsl(${hue}, 70%, 60%)`;
					ctx.fillRect(i * barWidth, canvas.height - barHeight, barWidth - 1, barHeight);
				}
			}
			draw();
		}
	</script>
</body>
</html>
